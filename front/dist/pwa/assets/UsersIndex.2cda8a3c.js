import{_ as G,Q as r,R as n,S as a,T as l,L as c,ar as f,X as h,a0 as g,U as p,aE as b,aC as k,aB as _,V as d,W as Q,aT as S,aD as D,b8 as A,a3 as w}from"./index.f80365d6.js";import{a as v,b as u,e as V}from"./QChip.08550cf1.js";import{Q as N}from"./QBtnDropdown.b639adfc.js";import{b as U,Q as B}from"./QTable.412455c2.js";import{Q as q}from"./QTooltip.46c74439.js";import{b as P,Q as C}from"./QSpace.7c1e1b57.js";import{Q as E}from"./QForm.a47eb8f7.js";import{Q as R}from"./QPage.6300838b.js";import{C as I}from"./ClosePopup.66f8b3cf.js";import"./QList.4d135fc3.js";import"./QMarkupTable.d2b210d5.js";import"./use-fullscreen.4c669e95.js";import"./format.2cae61da.js";const T={name:"ClientsIndex",data(){return{columns:[{name:"option",label:"Opciones",align:"left",field:e=>e.option},{name:"id",label:"ID",align:"left",field:e=>e.id},{name:"name",label:"Nombre",align:"left",field:e=>e.name},{name:"username",label:"Usuario",align:"left",field:e=>e.username},{name:"company",label:"Empresa",align:"left",field:e=>{var s;return(s=e==null?void 0:e.company)==null?void 0:s.name}},{name:"boat",label:"Barco",align:"left",field:e=>{var s;return(s=e==null?void 0:e.boat)==null?void 0:s.name}},{name:"role",label:"Rol",align:"left",field:e=>e.role}],loading:!1,users:[],user:{},userDialog:!1,clienDialogHistory:!1,filter:"",passwordShow:!1,permisos:[],permisosSelected:[],dialogPermisos:!1,companies:[],boats:[]}},mounted(){this.companiesGet(),this.boatGet(),this.permissionGet(),this.userGet()},methods:{companiesGet(){this.loading=!0,this.$axios.get("companies").then(e=>{this.companies=e.data}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},boatGet(){this.loading=!0,this.$axios.get("boats").then(e=>{this.boats=e.data}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},userPermisos(){this.loading=!0,this.$axios.put(`permissions/${this.user.id}`,{permissions:this.permisosSelected}).then(e=>{this.dialogPermisos=!1;const s=this.users.findIndex(t=>t.id===e.data.id);this.users.splice(s,1,e.data)}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},permisosUpdate(e){this.user=e,this.permisosSelected=e.permissions.map(s=>s.id),this.dialogPermisos=!0},permissionGet(){this.$axios.get("permissions").then(e=>{e.data.forEach(s=>{s.label=s.name,s.value=s.id}),this.permisos=e.data}).catch(e=>{this.$alert.error(e.response.data.message)})},userSave(){this.loading=!0,this.user.id?this.$axios.put(`users/${this.user.id}`,this.user).then(e=>{this.userDialog=!1;const s=this.users.findIndex(t=>t.id===this.user.id);this.users.splice(s,1,e.data)}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1}):this.$axios.post("users",this.user).then(e=>{this.userDialog=!1,this.users.unshift(e.data)}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},userChangePassword(e){this.$alert.promptPassword("Ingrese la nueva contrase\xF1a").onOk(s=>{this.loading=!0,this.$axios.put(`passwordUpdate/${e.id}`,{password:s}).then(t=>{this.$alert.success("Contrase\xF1a cambiada con \xE9xito")}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})})},userDelete(e){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este usere?").onOk(()=>{this.loading=!0,this.$axios.delete(`users/${e.id}`).then(s=>{const t=this.users.findIndex(x=>x.id===s.data.id);t>-1&&this.users.splice(t,1)}).catch(s=>{this.$alert.error(s.response.data.message)}).finally(()=>{this.loading=!1})})},userEdit(e){this.userDialog=!0,e.company_id="",this.user={...e}},userAdd(){this.userDialog=!0,this.user={name:"",ci:""}},userGet(){this.loading=!0,this.$axios.get("users").then(e=>{this.users=e.data}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})}}},O={class:"text-h6"},M={class:"row"},F={class:"col-12"},H={class:"col-12"},L={class:"col-12"},W={class:"col-12"},X={class:"col-12"},j={class:"col-12"},z={class:"text-h6"};function J(e,s,t,x,o,m){return r(),n(R,{class:"bg-grey-3 q-pa-md"},{default:a(()=>[l(B,{rows:o.users,columns:o.columns,title:"Usuarios","rows-per-page-options":[0],"row-key":"id",dense:"",filter:o.filter,loading:o.loading},{"body-cell-option":a(i=>[l(U,{"auto-width":""},{default:a(()=>[l(N,{flat:"",dense:"","dropdown-icon":"more_vert","auto-close":""},{default:a(()=>[c((r(),n(v,{clickable:"",onClick:y=>m.userEdit(i.row)},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(f,{name:"edit"})]),_:1}),l(u,null,{default:a(()=>[h("Editar")]),_:1})]),_:2},1032,["onClick"])),[[w]]),c((r(),n(v,{clickable:"",onClick:y=>m.userDelete(i.row)},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(f,{name:"delete"})]),_:1}),l(u,null,{default:a(()=>[h("Eliminar")]),_:1})]),_:2},1032,["onClick"])),[[w]]),c((r(),n(v,{clickable:"",onClick:y=>m.userChangePassword(i.row)},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(f,{name:"vpn_key"})]),_:1}),l(u,null,{default:a(()=>[h("Cambiar Contrase\xF1a")]),_:1})]),_:2},1032,["onClick"])),[[w]]),c((r(),n(v,{clickable:"",onClick:y=>m.permisosUpdate(i.row)},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(f,{name:"verified_user"})]),_:1}),l(u,null,{default:a(()=>[h("Permisos")]),_:1})]),_:2},1032,["onClick"])),[[w]])]),_:2},1024)]),_:2},1024)]),"body-cell-role":a(i=>[l(U,{props:i},{default:a(()=>[i.row.role==="VENDEDOR"?(r(),n(V,{key:0,dense:"",label:"Vendedor",color:"orange","text-color":"white",icon:"account_circle"})):g("",!0),i.row.role==="ADMIN"?(r(),n(V,{key:1,dense:"",label:"Admin",color:"indigo","text-color":"white",icon:"account_circle"})):g("",!0),i.row.role==="SUPERADMIN"?(r(),n(V,{key:2,dense:"",label:"Super admin",color:"purple","text-color":"white",icon:"account_circle"})):g("",!0),i.row.role==="PATRON"?(r(),n(V,{key:3,dense:"",label:"Patron",color:"green","text-color":"white",icon:"account_circle"})):g("",!0)]),_:2},1032,["props"])]),"top-right":a(()=>[l(p,{outline:"",dense:"",icon:"add_circle",onClick:m.userAdd,label:"Agregar","no-caps":"",loading:o.loading},{default:a(()=>[l(q,null,{default:a(()=>[h("Agregar")]),_:1})]),_:1},8,["onClick","loading"]),l(b,{modelValue:o.filter,"onUpdate:modelValue":s[0]||(s[0]=i=>o.filter=i),dense:"",class:"q-ml-md",debounce:"300",placeholder:"Buscar",outlined:"",clearable:""},{append:a(()=>[l(f,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter","loading"]),l(D,{modelValue:o.userDialog,"onUpdate:modelValue":s[9]||(s[9]=i=>o.userDialog=i),persistent:""},{default:a(()=>[l(k,{style:{width:"250px","max-width":"90vw"}},{default:a(()=>[l(_,{class:"row items-center q-pb-none"},{default:a(()=>[d("div",O,Q(o.user.id?"Editar":"Agregar")+" Usuario",1),l(P),l(p,{flat:"",dense:"",icon:"close",onClick:s[1]||(s[1]=i=>o.userDialog=!1)})]),_:1}),l(E,{onSubmit:m.userSave},{default:a(()=>[l(_,null,{default:a(()=>[d("div",M,[d("div",F,[l(b,{modelValue:o.user.name,"onUpdate:modelValue":s[2]||(s[2]=i=>o.user.name=i),label:"Nombre",outlined:"",dense:"",rules:[i=>!!i||"Campo requerido"]},null,8,["modelValue","rules"])]),d("div",H,[l(b,{modelValue:o.user.username,"onUpdate:modelValue":s[3]||(s[3]=i=>o.user.username=i),label:"Usuario",outlined:"",dense:"",rules:[i=>!!i||"Campo requerido"]},null,8,["modelValue","rules"])]),d("div",L,[l(C,{modelValue:o.user.company_id,"onUpdate:modelValue":s[4]||(s[4]=i=>o.user.company_id=i),label:"Empresa",outlined:"",dense:"",options:o.companies,"option-label":"name","option-value":"id",hint:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),d("div",W,[l(C,{modelValue:o.user.boat_id,"onUpdate:modelValue":s[5]||(s[5]=i=>o.user.boat_id=i),label:"Barco",outlined:"",dense:"",options:o.boats,"option-label":"name","option-value":"id",hint:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),d("div",X,[o.user.id?g("",!0):(r(),n(b,{key:0,modelValue:o.user.password,"onUpdate:modelValue":s[7]||(s[7]=i=>o.user.password=i),label:"Contrase\xF1a",outlined:"",dense:"",rules:[i=>!!i||"Campo requerido"],type:o.passwordShow?"text":"password"},{append:a(()=>[l(f,{name:o.passwordShow?"visibility":"visibility_off",onClick:s[6]||(s[6]=i=>o.passwordShow=!o.passwordShow)},null,8,["name"])]),_:1},8,["modelValue","rules","type"]))]),d("div",j,[l(C,{modelValue:o.user.role,"onUpdate:modelValue":s[8]||(s[8]=i=>o.user.role=i),label:"Rol",outlined:"",dense:"",options:e.$roles,rules:[i=>!!i||"Campo requerido"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"])])])]),_:1}),l(S,{align:"right"},{default:a(()=>[c(l(p,{flat:"",label:"Cancelar",loading:o.loading},null,8,["loading"]),[[I]]),l(p,{color:"primary",label:"Guardar",type:"submit",loading:o.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),l(D,{modelValue:o.dialogPermisos,"onUpdate:modelValue":s[12]||(s[12]=i=>o.dialogPermisos=i)},{default:a(()=>[l(k,{style:{width:"450px","max-width":"90vw"}},{default:a(()=>[l(_,{class:"row items-center q-pb-none"},{default:a(()=>[d("div",z,"Permisos de "+Q(o.user.name),1),l(P),l(p,{flat:"",dense:"",icon:"close",onClick:s[10]||(s[10]=i=>o.dialogPermisos=!1)})]),_:1}),l(E,{onSubmit:m.userPermisos},{default:a(()=>[l(_,null,{default:a(()=>[l(A,{modelValue:o.permisosSelected,"onUpdate:modelValue":s[11]||(s[11]=i=>o.permisosSelected=i),options:o.permisos,dense:"",type:"checkbox"},null,8,["modelValue","options"])]),_:1}),l(S,{align:"right"},{default:a(()=>[c(l(p,{flat:"",label:"Cancelar",loading:o.loading},null,8,["loading"]),[[I]]),l(p,{color:"primary",label:"Guardar",type:"submit",loading:o.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var de=G(T,[["render",J]]);export{de as default};
