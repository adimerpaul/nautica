import{_ as Q,Q as n,R as x,S as a,T as s,aB as p,V as e,aE as f,a0 as c,a1 as b,a2 as y,aC as m,an as v,U as _,$ as q,W as d,Z as I,aF as P,aG as S,X as V,L as C,bc as w}from"./index.4319c963.js";import{a as g,Q as k}from"./QSpace.27613a12.js";import{Q as U}from"./QImg.03bb2439.js";import{Q as A}from"./QMarkupTable.d20d8c17.js";import{Q as D}from"./QForm.73fa8586.js";import{Q as T}from"./QPage.9e475deb.js";import"./format.6e3f05a1.js";import"./position-engine.96e7d4d7.js";const E={name:"ProductsIndex",data(){return{products:[],productsAll:[],clients:[],clientsAll:[],client:"",product:{},categories:[],category:"",search:"",saleDialog:!1,loading:!1,tipo:"",tipos:["CREDITO","EFECTIVO"],monto:""}},mounted(){this.productsGet(),this.clientGet(),this.categoriesGet()},methods:{saleInsert(){this.loading=!0,this.$axios.post("sales",{client_id:this.client.id,tipo:this.tipo,monto:this.monto,products:this.$store.orders}).then(o=>{this.$alert.success("Venta realizada con \xE9xito"),this.saleDialog=!1,this.cartClear(),this.productsGet()}).catch(o=>{this.$alert.error("Error al realizar la venta")}).finally(()=>{this.loading=!1})},clientGet(){this.$axios.get("clients").then(o=>{this.clients=o.data,this.clientsAll=o.data})},pay(){if(this.$store.orders.length===0)return this.$alert.error("No hay productos en el carrito"),!1;this.saleDialog=!0,this.client="",this.tipo="",this.monto=""},deleteProduct(o){const l=this.$store.orders.findIndex(u=>u.id===o.id);this.$store.orders.splice(l,1)},sumNum(o,l){return(parseFloat(o)*parseInt(l)).toFixed(2)},orderAdd(o){const l=this.$store.orders.find(u=>u.id===o.id);l?l.quantity++:this.$store.orders.push({...o,quantity:1})},cartClear(){this.$store.orders=[]},productsGet(){this.$axios.get("products").then(o=>{this.products=o.data,this.productsAll=o.data})},categoriesGet(){this.categories=[{id:"",name:"Todas"}],this.$axios.get("categories").then(o=>{this.categories=this.categories.concat(o.data)})},filterProductsSearch(){this.search===""?this.products=this.productsAll:this.products=this.productsAll.filter(o=>o.name.toLowerCase().includes(this.search.toLowerCase()))},filterProducts(){console.log(this.category),this.category.id===""?this.products=this.productsAll:this.products=this.productsAll.filter(o=>o.category_id===this.category.id)}},computed:{total(){return this.$store.orders.reduce((o,l)=>o+parseFloat(l.price)*parseInt(l.quantity),0).toFixed(2)}}},F={class:"row"},G={class:"col-12 col-md-8"},N={class:"row"},B={class:"col-12 col-md-4"},z={class:"col-12 col-md-3 text-right"},L=e("div",{class:"col-12 col-md-5 text-right"},null,-1),O={class:"col-12"},R={class:"row"},M={class:"absolute-bottom text-subtitle2 text-center text-bold",style:{padding:"0px",background:"linear-gradient(rgba(0,0,0,0.05), rgba(0,0,0,0.7))",color:"white","line-height":"1"}},W={class:"row items-center"},X={class:"text-bold text-center q-pl-xs"},Z={class:"text-bold text-center q-pr-xs"},$={class:"col-12 col-md-4"},j={class:"row"},H=e("div",{class:"text-subtitle2 text-primary text-bold q-pl-xs"}," Carrito de Compras ",-1),J=e("thead",{class:"bg-primary text-white"},[e("tr",null,[e("th",null,"Producto"),e("th",{class:"text-right"},"Precio"),e("th",{class:"text-right"},"Cantidad"),e("th",{class:"text-right",width:"80px"},"Total")])],-1),K={key:0},Y={style:{"max-width":"170px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},ee={class:"text-right"},te=["onUpdate:modelValue"],se={class:"text-right"},oe=["onUpdate:modelValue"],le={class:"text-right"},ie={key:1},ae=e("tr",null,[e("td",{colspan:"4",class:"text-center"}," No hay productos en el carrito ")],-1),re=[ae],ne=e("td",{colspan:"3",class:"text-right text-bold"}," Total ",-1),de={class:"text-right text-subtitle2 text-red text-bold"},ce={colspan:"4"},ue=e("div",{class:"text-h6 text-primary text-center"}," Pago ",-1),he={class:"row"},pe={class:"col-12 col-md-4"},me={class:"col-6 col-md-2 text-bold text-red text-h6 text-center"},_e={class:"col-6 col-md-4"},ge={class:"col-12 col-md-2"};function xe(o,l,u,fe,i,r){return n(),x(T,{class:"bg-grey-3 q-pa-xs"},{default:a(()=>[s(m,null,{default:a(()=>[s(p,{class:"q-pa-xs"},{default:a(()=>[e("div",F,[e("div",G,[e("div",N,[e("div",B,[s(f,{modelValue:i.search,"onUpdate:modelValue":[l[0]||(l[0]=t=>i.search=t),r.filterProductsSearch],label:"Buscar",outlined:"",dense:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),e("div",z,[s(g,{modelValue:i.category,"onUpdate:modelValue":[l[1]||(l[1]=t=>i.category=t),r.filterProducts],options:i.categories,label:"Categor\xEDa",outlined:"",dense:"","option-value":"id","option-label":"name"},null,8,["modelValue","options","onUpdate:modelValue"])]),L,e("div",O,[e("div",R,[(n(!0),c(y,null,b(i.products,t=>(n(),c("div",{class:"col-6 col-md-2",key:t.id},[s(m,{class:"q-ma-xs cursor-pointer",flat:"",bordered:"",onClick:h=>r.orderAdd(t)},{default:a(()=>[s(U,{src:`${o.$url}../images/${t.image}`,"spinner-color":"white","spinner-size":"40",style:{height:"100px"}},{default:a(()=>[e("div",M,[V(d(t.name)+" ",1),e("div",W,[e("div",X,d(t.stock),1),s(k),e("div",Z,d(t.price)+" $ ",1)])])]),_:2},1032,["src"])]),_:2},1032,["onClick"])]))),128))])])])]),e("div",$,[s(m,null,{default:a(()=>[s(p,{class:"q-pb-none row items-center"},{default:a(()=>[e("div",j,[s(v,{name:"o_shopping_cart"}),H]),s(k),s(_,{flat:"",dense:"",icon:"o_delete",onClick:r.cartClear,size:"10px",label:"Vaciar","no-caps":"",color:"red"},null,8,["onClick"])]),_:1}),s(q),s(p,{class:"q-pa-none"},{default:a(()=>[s(A,{dense:"","wrap-cells":""},{default:a(()=>[J,o.$store.orders.length>0?(n(),c("tbody",K,[(n(!0),c(y,null,b(o.$store.orders,t=>(n(),c("tr",{key:t.id},[e("td",null,[e("div",Y,[s(v,{name:"o_delete",class:"cursor-pointer",color:"red",onClick:h=>r.deleteProduct(t)},null,8,["onClick"]),V(" "+d(t.name),1)])]),e("td",ee,[C(e("input",{"onUpdate:modelValue":h=>t.price=h,type:"number",min:"1",style:{width:"50px"},step:"0.01"},null,8,te),[[w,t.price]])]),e("td",se,[C(e("input",{"onUpdate:modelValue":h=>t.quantity=h,type:"number",min:"1",style:{width:"50px"}},null,8,oe),[[w,t.quantity]])]),e("td",le,d(r.sumNum(t.price,t.quantity))+" $ ",1)]))),128))])):(n(),c("tbody",ie,re)),e("tfoot",null,[e("tr",null,[ne,e("td",de,d(r.total)+" $ ",1)]),e("tr",null,[e("td",ce,[s(_,{dense:"",color:"primary",label:"Pagar","no-caps":"",icon:"o_payment",push:"",class:"full-width text-bold",onClick:r.pay},null,8,["onClick"])])])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1}),s(S,{modelValue:i.saleDialog,"onUpdate:modelValue":l[6]||(l[6]=t=>i.saleDialog=t),persistent:""},{default:a(()=>[s(m,{style:{width:"700px","max-width":"90vw"}},{default:a(()=>[s(p,{class:"q-pb-none"},{default:a(()=>[ue]),_:1}),s(p,null,{default:a(()=>[s(D,{onSubmit:r.saleInsert},{default:a(()=>[e("div",he,[e("div",pe,[s(g,{modelValue:i.client,"onUpdate:modelValue":l[2]||(l[2]=t=>i.client=t),options:i.clients,label:"Cliente",outlined:"",dense:"","option-value":"id","option-label":"name",rules:[t=>!!t||"Seleccione un cliente"]},null,8,["modelValue","options","rules"])]),e("div",me,d(r.total)+"$ ",1),e("div",_e,[s(g,{modelValue:i.tipo,"onUpdate:modelValue":l[3]||(l[3]=t=>i.tipo=t),options:i.tipos,label:"Tipo",outlined:"",dense:"",rules:[t=>!!t||"Seleccione un tipo"]},null,8,["modelValue","options","rules"])]),e("div",ge,[i.tipo==="CREDITO"?(n(),x(f,{key:0,modelValue:i.monto,"onUpdate:modelValue":l[4]||(l[4]=t=>i.monto=t),label:"Adelanto",outlined:"",dense:"",type:"number",rules:[t=>!!t||"Ingrese un monto",t=>t>=0||"Ingrese un monto v\xE1lido",t=>t<=r.total||"El monto no puede ser mayor al total"]},null,8,["modelValue","rules"])):I("",!0)])]),s(P,{align:"right"},{default:a(()=>[s(_,{label:"Cancelar",color:"red","no-caps":"",class:"text-bold",push:"",icon:"cancel",onClick:l[5]||(l[5]=t=>i.saleDialog=!1),loading:i.loading},null,8,["loading"]),s(_,{label:"Pagar",color:"primary","no-caps":"",class:"text-bold",push:"",icon:"o_payment",type:"submit",loading:i.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var qe=Q(E,[["render",xe]]);export{qe as default};
