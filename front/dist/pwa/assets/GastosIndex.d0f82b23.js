import{_ as E,P as F,Q as m,Y as _,T as o,S as a,aD as G,$ as Q,V as i,aE as b,ar as y,U as h,X as r,R as v,L as k,a0 as x,W as c,a4 as O}from"./index.abfdc3b2.js";import{Q as A,a as u,b as p}from"./QTable.0ac775ec.js";import{Q as C}from"./index.d7d5260b.js";import{a as S,b as w,e as I}from"./QChip.1687f1b4.js";import{Q as U}from"./QList.50a08c0c.js";import{Q as T}from"./QBtnDropdown.01843d24.js";import{Q as R}from"./QTooltip.ce72369c.js";import{Q as M}from"./QPage.ddf71f8f.js";import{C as V}from"./ClosePopup.fc90dd23.js";import{h as D}from"./moment.40bc58bf.js";import{D as B,I as L}from"./DialogGasto.f8ca729e.js";import"./QMarkupTable.11bc8ee8.js";import"./QSelect.59c01bbe.js";import"./format.2cae61da.js";import"./use-fullscreen.2d871973.js";import"./_commonjsHelpers.48c1ef9f.js";import"./QSpace.94ffd6db.js";import"./QForm.cfca3500.js";import"./index.22e72184.js";const P={name:"GastosIndex",components:{DialogGasto:B},data(){return{gastoDialog:!1,fechaInicioSemana:D().startOf("isoWeek").format("YYYY-MM-DD"),fechaFinSemana:D().endOf("isoWeek").format("YYYY-MM-DD"),concepto:"",columns:[{name:"opcion",label:"Opcion",align:"left",field:"opcion"},{name:"proveedorcliente",label:"Proveedor / cliente",align:"left",field:"proveedor / cliente",sortable:!0},{name:"montoTotal",label:"Monto total",align:"left",field:"montoTotal",sortable:!0},{name:"fechayhora",label:"Fecha y hora",align:"left",field:"fechayhora",sortable:!0},{name:"concepto",label:"Concepto",align:"left",field:"concepto",sortable:!0},{name:"pago",label:"Pago",align:"left",field:"pago",sortable:!0},{name:"numeroFactura",label:"Numero de factura",align:"left",field:"numero de factura",sortable:!0},{name:"user",label:"Usuario",align:"left",field:l=>l.user.name,sortable:!0}],sales:[],loading:!1,filter:""}},mounted(){this.salesGastos()},methods:{exportarExcel(){this.loading=!0,this.$axios.get("exportSalesExcel",{params:{fechaInicioSemana:this.fechaInicioSemana,fechaFinSemana:this.fechaFinSemana,concepto:this.concepto},responseType:"blob"}).then(l=>{const t=window.URL.createObjectURL(new Blob([l.data])),n=document.createElement("a");n.href=t,n.setAttribute("download","ventas.xlsx"),document.body.appendChild(n),n.click()}).catch(l=>{console.log(l)}).finally(()=>{this.loading=!1})},exportarPdf(){this.loading=!0,this.$axios.get("exportSalesPdf",{params:{fechaInicioSemana:this.fechaInicioSemana,fechaFinSemana:this.fechaFinSemana,concepto:this.concepto},responseType:"blob"}).then(l=>{const t=window.URL.createObjectURL(new Blob([l.data])),n=document.createElement("a");n.href=t,n.setAttribute("download","ventas.pdf"),document.body.appendChild(n),n.click()}).catch(l=>{console.log(l)}).finally(()=>{this.loading=!1})},reimprimirNota(l){L.nota(l).then(t=>{})},saleAnular(l){this.$q.dialog({title:"Anular venta",message:"\xBFEst\xE1 seguro de anular la venta?",persistent:!0,prompt:{model:"",type:"text",label:"Motivo de anulaci\xF3n",required:!0},ok:{label:"Si",color:"negative",push:!0},cancel:{label:"No",color:"primary",push:!0}}).onOk(t=>{this.$axios.post("saleAnular",{id:l,motivo:t}).then(n=>{this.salesGastos()}).catch(n=>{console.log(n)})})},gastoCreated(l){this.sales.unshift(l),this.gastoDialog=!1},salesGastos(){this.loading=!0,this.$axios.get("salesGastos",{params:{fechaInicioSemana:this.fechaInicioSemana,fechaFinSemana:this.fechaFinSemana,concepto:this.concepto}}).then(l=>{this.sales=l.data,console.log(l.data)}).catch(l=>{console.log(l)}).finally(()=>{this.loading=!1})}},computed:{balance(){const l=this.sales.reduce((t,n)=>n.status!=="ANULADO"?n.tipo_venta==="INGRESO"?t+n.total:t-n.total:t,0);return Math.round(l*100)/100},ingreso(){const l=this.sales.reduce((t,n)=>n.tipo_venta==="INGRESO"&&n.status!=="ANULADO"&&n.pago==="EFECTIVO"?t+n.total:t,0);return Math.round(l*100)/100},ingresoTransferencia(){const l=this.sales.reduce((t,n)=>n.tipo_venta==="INGRESO"&&n.status!=="ANULADO"&&n.pago==="TRANSFERENCIA"?t+n.total:t,0);return Math.round(l*100)/100},gasto(){const l=this.sales.reduce((t,n)=>n.tipo_venta==="EGRESO"&&n.status!=="ANULADO"?t+n.total:t,0);return Math.round(l*100)/100}}},Y={key:0,class:"row"},z={class:"col-6 col-md-2 q-pa-xs"},q={class:"col-6 col-md-2 q-pa-xs"},W={class:"col-12 col-md-2 q-pa-xs"},j={class:"col-12 col-md-6 text-right"},H={key:1,class:"text-right"},X={class:"row"},J={class:"col-12"},K=i("div",null,"Imprimir nota",-1),Z=i("div",null,"Anular",-1),$={key:1,style:{width:"95px"}},ee={key:0,class:"text-grey-8"},oe={style:{}},ae={class:"q-ml-xs",style:{width:"180px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},te={class:"",style:{width:"100px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},le={class:"text-right text-red text-bold"},ne=i("div",{id:"myElement",class:"hidden"},null,-1);function se(l,t,n,ie,s,f){const N=F("DialogGasto");return m(),_(Q,null,[o(M,{class:"q-pa-xs bg-grey-3"},{default:a(()=>[l.$store.user.id==1?(m(),_("div",Y,[i("div",z,[o(b,{modelValue:s.fechaInicioSemana,"onUpdate:modelValue":[t[0]||(t[0]=e=>s.fechaInicioSemana=e),f.salesGastos],label:"Fecha inicio",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",q,[o(b,{modelValue:s.fechaFinSemana,"onUpdate:modelValue":[t[1]||(t[1]=e=>s.fechaFinSemana=e),f.salesGastos],label:"Fecha fin",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",W,[o(b,{modelValue:s.concepto,"onUpdate:modelValue":[t[2]||(t[2]=e=>s.concepto=e),f.salesGastos],label:"Buscar por concepto",dense:"",outlined:"",class:"bg-white",debounce:"300",clearable:"",placeholder:"Buscar por concepto"},{prepend:a(()=>[o(y,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),i("div",j,[o(h,{label:"Excel",color:"green",size:"10px",icon:"fa-solid fa-file-excel","no-caps":"",rounded:"",onClick:f.exportarExcel,loading:s.loading},null,8,["onClick","loading"]),o(h,{label:"Pdf",color:"red",size:"10px",icon:"fa-solid fa-file-pdf","no-caps":"",rounded:"",onClick:f.exportarPdf,loading:s.loading},null,8,["onClick","loading"]),o(h,{loading:s.loading,size:"10px",label:"Nuevo Gasto",color:"red",icon:"add_circle_outline","no-caps":"",rounded:"",onClick:t[3]||(t[3]=e=>s.gastoDialog=!0)},null,8,["loading"])])])):(m(),_("div",H,[o(h,{loading:s.loading,size:"10px",label:"Nuevo Gasto",color:"red",icon:"add_circle_outline","no-caps":"",rounded:"",onClick:t[4]||(t[4]=e=>s.gastoDialog=!0)},null,8,["loading"])])),i("div",X,[i("div",J,[o(A,{columns:s.columns,rows:s.sales,dense:"","rows-per-page-options":[0],filter:s.filter,loading:s.loading,"wrap-cells":"","no-data-label":"No hay ventas","no-results-label":"No hay gastos",title:"Historial de gastos"},{"top-right":a(()=>[o(b,{outlined:"",modelValue:s.filter,"onUpdate:modelValue":t[5]||(t[5]=e=>s.filter=e),debounce:"300",placeholder:"Buscar",dense:""},{append:a(()=>[o(h,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue"])]),header:a(e=>[o(C,{props:e,class:"bg-primary text-white"},{default:a(()=>[o(u,{key:"opcion",props:e,"auto-width":""},{default:a(()=>[r("Opcion")]),_:2},1032,["props"]),o(u,{key:"proveedorcliente",props:e},{default:a(()=>[r("Proveedor / cliente")]),_:2},1032,["props"]),o(u,{key:"montoTotal",props:e},{default:a(()=>[r("Monto total")]),_:2},1032,["props"]),o(u,{key:"fechayhora",props:e},{default:a(()=>[r("Fecha y hora")]),_:2},1032,["props"]),o(u,{key:"concepto",props:e},{default:a(()=>[r("Concepto")]),_:2},1032,["props"]),o(u,{key:"observacion",props:e},{default:a(()=>[r("Comentario")]),_:2},1032,["props"]),o(u,{key:"pago",props:e},{default:a(()=>[r("Pago")]),_:2},1032,["props"]),o(u,{key:"numeroFactura",props:e},{default:a(()=>[r("Num. Fac")]),_:2},1032,["props"]),o(u,{key:"user",props:e},{default:a(()=>[r("Usuario")]),_:2},1032,["props"]),o(u,{key:"lugar",props:e},{default:a(()=>[r("Lugar")]),_:2},1032,["props"])]),_:2},1032,["props"])]),body:a(e=>[o(C,{props:e},{default:a(()=>[o(p,{key:"opcion",props:e,"auto-width":""},{default:a(()=>[e.row.status=="ACTIVO"?(m(),v(T,{key:0,dense:"",icon:"more_vert",align:"right",label:"Opciones","no-caps":"",color:e.row.tipo_venta=="INGRESO"?"green-9":"red-9",size:"10px"},{default:a(()=>[o(U,null,{default:a(()=>[k((m(),v(S,{clickable:"",onClick:d=>f.reimprimirNota(e.row)},{default:a(()=>[o(w,{avatar:""},{default:a(()=>[o(y,{name:"o_print"})]),_:1}),o(w,null,{default:a(()=>[K]),_:1})]),_:2},1032,["onClick"])),[[V]]),k((m(),v(S,{clickable:"",onClick:d=>f.saleAnular(e.row.id)},{default:a(()=>[o(w,{avatar:""},{default:a(()=>[o(y,{name:"o_highlight_off"})]),_:1}),o(w,null,{default:a(()=>[Z]),_:1})]),_:2},1032,["onClick"])),[[V]])]),_:2},1024)]),_:2},1032,["color"])):(m(),_("div",$,[o(I,{label:"Anulado",color:"grey-4","text-color":"white",dense:"",flat:""}),e.row.motivo_anulacion?(m(),v(h,{key:0,dense:"",color:"red-4",size:"10px","no-caps":"","no-wrap":"",icon:"visibility",onClick:d=>l.$alert.dialogShow(e.row.motivo_anulacion)},{default:a(()=>[o(R,null,{default:a(()=>[r("Motivo de anulaci\xF3n")]),_:1})]),_:2},1032,["onClick"])):x("",!0)]))]),_:2},1032,["props"]),o(p,{key:"proveedorcliente",props:e},{default:a(()=>{var d,g;return[e.row.client?(m(),_("div",ee,c((d=e.row.client)==null?void 0:d.name)+" "+c((g=e.row.client)==null?void 0:g.lastname),1)):x("",!0)]}),_:2},1032,["props"]),o(p,{key:"montoTotal",props:e,class:"text-right"},{default:a(()=>[i("span",{class:O(`text-${e.row.tipo_venta=="INGRESO"?"green":"red"}-7 text-bold`)},c(e.row.total)+" $ ",3)]),_:2},1032,["props"]),o(p,{key:"fechayhora",props:e,style:{"min-width":"150px"}},{default:a(()=>[r(c(l.$filters.dateDmYHis(e.row.date)),1)]),_:2},1032,["props"]),o(p,{key:"concepto",props:e,class:""},{default:a(()=>{var d,g;return[i("div",null,[i("div",oe,[i("div",ae,c(e.row.description)+" "+c((g=(d=e.row)==null?void 0:d.boat)==null?void 0:g.name),1)])])]}),_:2},1032,["props"]),o(p,{key:"observacion",props:e},{default:a(()=>[i("div",te,c(e.row.observacion),1)]),_:2},1032,["props"]),o(p,{key:"pago",props:e},{default:a(()=>[o(I,{color:`${e.row.pago=="EFECTIVO"?"blue":"green"}-5`,"text-color":"white",dense:"",flat:"",label:e.row.pago},null,8,["color","label"])]),_:2},1032,["props"]),o(p,{key:"numeroFactura",props:e},{default:a(()=>[i("p",le,c(e.row.numeroFactura),1)]),_:2},1032,["props"]),o(p,{key:"user",props:e},{default:a(()=>{var d;return[i("p",null,c((d=e.row.user)==null?void 0:d.name),1)]}),_:2},1032,["props"]),o(p,{key:"lugar",props:e},{default:a(()=>[i("p",null,c(e.row.lugar),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["columns","rows","filter","loading"])])])]),_:1}),o(G,{modelValue:s.gastoDialog,"onUpdate:modelValue":t[6]||(t[6]=e=>s.gastoDialog=e),position:"right",maximized:""},{default:a(()=>[o(N,{onGastoCreated:f.gastoCreated},null,8,["onGastoCreated"])]),_:1},8,["modelValue"]),ne],64)}var Ve=E(P,[["render",se]]);export{Ve as default};
