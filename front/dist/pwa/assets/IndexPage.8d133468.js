import{_ as O,Q as f,R as b,S as a,T as o,V as s,U as h,X as r,W as d,ar as F,aB as T,a4 as k,aC as G,P as C,Y as x,aD as U,$ as R,aE as w,a0 as y,L as S}from"./index.a4e785c1.js";import{Q as P,a as p,b as m}from"./QTable.364b9868.js";import{Q as I}from"./index.04c5fc83.js";import{Q as v}from"./QTooltip.01da4631.js";import{a as E,e as N}from"./QChip.8ebf79c0.js";import{Q as q}from"./QBtnDropdown.d9519c7d.js";import{Q as B}from"./QPage.b4c1b664.js";import{C as V}from"./ClosePopup.05c97061.js";import{h as D}from"./moment.40bc58bf.js";import{D as M,I as z}from"./DialogGasto.d354b5a8.js";import"./QList.08f6fb06.js";import"./QMarkupTable.e80f7b8d.js";import"./QSelect.9609ca3c.js";import"./format.2cae61da.js";import"./use-fullscreen.9b701c8d.js";import"./_commonjsHelpers.48c1ef9f.js";import"./QSpace.8ba3c190.js";import"./QForm.d24114a1.js";import"./index.22e72184.js";const L={name:"CardComponent",props:{title:{type:String,default:"Card Title"},icon:{type:String,default:"account_balance"},to:{type:String,default:"/"},color:{type:String,default:"green"},amount:{type:Number,default:2e3}}},Y={class:"row"},W={class:"col-12"},j={class:"col-12 flex flex-center"},H={class:"text-h3 text-white text-bold"};function X(l,n,t,A,i,c){return f(),b(G,{class:k("bg-"+t.color+" q-ma-xs cursor-pointer"),onClick:n[0]||(n[0]=g=>l.$router.push(t.to))},{default:a(()=>[o(T,{class:"q-pa-xs"},{default:a(()=>[s("div",Y,[s("div",W,[o(h,{flat:"",dense:"",label:t.title,color:"white",icon:t.icon,to:t.to,"no-caps":""},null,8,["label","icon","to"])]),s("div",j,[s("div",H,[r(d(t.amount)+" ",1),o(F,{name:t.icon,size:"50px",color:"white"},null,8,["name"])])])])]),_:1}),o(v,null,{default:a(()=>[r(d(t.title),1)]),_:1})]),_:1},8,["class"])}var J=O(L,[["render",X]]);const K={name:"IndexPage",components:{DialogGasto:M,CardComponent:J},data(){return{gastoDialog:!1,fechaInicioSemana:D().startOf("isoWeek").format("YYYY-MM-DD"),fechaFinSemana:D().endOf("isoWeek").format("YYYY-MM-DD"),concepto:"",columns:[{name:"opcion",label:"Opcion",align:"left",field:"opcion"},{name:"proveedorcliente",label:"Proveedor / cliente",align:"left",field:"proveedor / cliente",sortable:!0},{name:"montoTotal",label:"Monto total",align:"left",field:"montoTotal",sortable:!0},{name:"fechayhora",label:"Fecha y hora",align:"left",field:"fechayhora",sortable:!0},{name:"concepto",label:"Concepto",align:"left",field:"concepto",sortable:!0},{name:"observacion",label:"Comentario",align:"left",field:"observacion",sortable:!0},{name:"pago",label:"Pago",align:"left",field:"pago",sortable:!0},{name:"numeroFactura",label:"Numero de factura",align:"left",field:"numero de factura",sortable:!0},{name:"user",label:"Usuario",align:"left",field:l=>l.user.name,sortable:!0}],sales:[],loading:!1,filter:""}},mounted(){this.salesGet()},methods:{exportarExcel(){this.loading=!0,this.$axios.get("exportSalesExcel",{params:{fechaInicioSemana:this.fechaInicioSemana,fechaFinSemana:this.fechaFinSemana,concepto:this.concepto},responseType:"blob"}).then(l=>{const n=window.URL.createObjectURL(new Blob([l.data])),t=document.createElement("a");t.href=n,t.setAttribute("download","ventas.xlsx"),document.body.appendChild(t),t.click()}).catch(l=>{console.log(l)}).finally(()=>{this.loading=!1})},exportarPdf(){this.loading=!0,this.$axios.get("exportSalesPdf",{params:{fechaInicioSemana:this.fechaInicioSemana,fechaFinSemana:this.fechaFinSemana,concepto:this.concepto},responseType:"blob"}).then(l=>{const n=window.URL.createObjectURL(new Blob([l.data])),t=document.createElement("a");t.href=n,t.setAttribute("download","ventas.pdf"),document.body.appendChild(t),t.click()}).catch(l=>{console.log(l)}).finally(()=>{this.loading=!1})},reimprimirNota(l){z.nota(l).then(n=>{})},saleAnular(l){this.$q.dialog({title:"Anular venta",message:"\xBFEst\xE1 seguro de anular la venta?",persistent:!0,prompt:{model:"",type:"text",label:"Motivo de anulaci\xF3n",required:!0},ok:{label:"Si",color:"negative",push:!0},cancel:{label:"No",color:"primary",push:!0}}).onOk(n=>{this.$axios.post("saleAnular",{id:l,motivo:n}).then(t=>{this.salesGet()}).catch(t=>{console.log(t)})})},gastoCreated(l){this.sales.unshift(l),this.gastoDialog=!1},salesGet(){this.loading=!0,this.$axios.get("sales",{params:{fechaInicioSemana:this.fechaInicioSemana,fechaFinSemana:this.fechaFinSemana,concepto:this.concepto}}).then(l=>{this.sales=l.data,console.log(l.data)}).catch(l=>{console.log(l)}).finally(()=>{this.loading=!1})}},computed:{balance(){const l=this.sales.reduce((n,t)=>t.status!=="ANULADO"?t.tipo_venta==="INGRESO"?n+t.total:n-t.total:n,0);return Math.round(l*100)/100},ingreso(){const l=this.sales.reduce((n,t)=>t.tipo_venta==="INGRESO"&&t.status!=="ANULADO"&&t.pago==="EFECTIVO"?n+t.total:n,0);return Math.round(l*100)/100},ingresoTransferencia(){const l=this.sales.reduce((n,t)=>t.tipo_venta==="INGRESO"&&t.status!=="ANULADO"&&t.pago==="TRANSFERENCIA"?n+t.total:n,0);return Math.round(l*100)/100},gasto(){const l=this.sales.reduce((n,t)=>t.tipo_venta==="EGRESO"&&t.status!=="ANULADO"?n+t.total:n,0);return Math.round(l*100)/100}}},Z={key:0,class:"row"},$={class:"col-6 col-md-2 q-pa-xs"},ee={class:"col-6 col-md-2 q-pa-xs"},oe={class:"col-12 col-md-2 q-pa-xs"},te={class:"col-12 col-md-2 text-right"},ae=s("div",{class:"col-12 col-md-4 text-right"},null,-1),le={class:"col-12 col-md-3 q-pa-xs"},ne={class:"col-12 col-md-3 q-pa-xs"},se={class:"col-12 col-md-3 q-pa-xs"},ie={class:"col-12 col-md-3 q-pa-xs"},re={class:"row"},ce={class:"col-12"},de={key:1,style:{width:"95px"}},ue={key:0,class:"text-grey-8"},pe={style:{"padding-left":"15px"}},me={class:"q-ml-xs",style:{width:"180px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},fe={class:"",style:{width:"100px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},he={class:"text-right text-red text-bold"},ge=s("div",{id:"myElement",class:"hidden"},null,-1);function _e(l,n,t,A,i,c){const g=C("CardComponent"),Q=C("DialogGasto");return f(),x(R,null,[o(B,{class:"q-pa-xs bg-grey-3"},{default:a(()=>[l.$store.user.role=="SUPERADMIN"?(f(),x("div",Z,[s("div",$,[o(w,{modelValue:i.fechaInicioSemana,"onUpdate:modelValue":[n[0]||(n[0]=e=>i.fechaInicioSemana=e),c.salesGet],label:"Fecha inicio",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",ee,[o(w,{modelValue:i.fechaFinSemana,"onUpdate:modelValue":[n[1]||(n[1]=e=>i.fechaFinSemana=e),c.salesGet],label:"Fecha fin",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",oe,[o(w,{modelValue:i.concepto,"onUpdate:modelValue":[n[2]||(n[2]=e=>i.concepto=e),c.salesGet],label:"Buscar por concepto",dense:"",outlined:"",class:"bg-white",debounce:"300",clearable:"",placeholder:"Buscar por concepto"},{prepend:a(()=>[o(F,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),s("div",te,[o(h,{label:"Excel",color:"green",size:"10px",icon:"fa-solid fa-file-excel","no-caps":"",rounded:"",onClick:c.exportarExcel,loading:i.loading},null,8,["onClick","loading"]),o(h,{label:"Pdf",color:"red",size:"10px",icon:"fa-solid fa-file-pdf","no-caps":"",rounded:"",onClick:c.exportarPdf,loading:i.loading},null,8,["onClick","loading"])]),ae,s("div",le,[o(g,{amount:c.balance,color:"grey",title:"Balance",icon:"account_balance"},null,8,["amount"])]),s("div",ne,[o(g,{amount:c.ingresoTransferencia,color:"blue",title:"Transferencias",icon:"o_trending_up"},null,8,["amount"])]),s("div",se,[o(g,{amount:c.ingreso,color:"green",title:"Efectivo",icon:"o_trending_up"},null,8,["amount"])]),s("div",ie,[o(g,{amount:c.gasto,color:"red",title:"Gastos",icon:"o_trending_down"},null,8,["amount"])])])):y("",!0),s("div",re,[s("div",ce,[o(P,{columns:i.columns,rows:i.sales,dense:"","rows-per-page-options":[0],filter:i.filter,loading:i.loading,"wrap-cells":"","no-data-label":"No hay ventas","no-results-label":"No hay ventas",title:"Historial de ventas"},{"top-right":a(()=>[o(w,{outlined:"",modelValue:i.filter,"onUpdate:modelValue":n[3]||(n[3]=e=>i.filter=e),debounce:"300",placeholder:"Buscar",dense:""},{append:a(()=>[o(h,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue"])]),header:a(e=>[o(I,{props:e,class:"bg-primary text-white"},{default:a(()=>[o(p,{key:"opcion",props:e,"auto-width":""},{default:a(()=>[r("Opcion")]),_:2},1032,["props"]),o(p,{key:"proveedorcliente",props:e},{default:a(()=>[r("Proveedor / cliente")]),_:2},1032,["props"]),o(p,{key:"montoTotal",props:e},{default:a(()=>[r("Monto total")]),_:2},1032,["props"]),o(p,{key:"fechayhora",props:e},{default:a(()=>[r("Fecha y hora")]),_:2},1032,["props"]),o(p,{key:"concepto",props:e},{default:a(()=>[r("Concepto")]),_:2},1032,["props"]),o(p,{key:"observacion",props:e},{default:a(()=>[r("Comentario")]),_:2},1032,["props"]),o(p,{key:"pago",props:e},{default:a(()=>[r("Pago")]),_:2},1032,["props"]),o(p,{key:"numeroFactura",props:e},{default:a(()=>[r("Num. Fac")]),_:2},1032,["props"]),o(p,{key:"user",props:e},{default:a(()=>[r("Usuario")]),_:2},1032,["props"]),o(p,{key:"lugar",props:e},{default:a(()=>[r("Lugar")]),_:2},1032,["props"])]),_:2},1032,["props"])]),body:a(e=>[o(I,{props:e},{default:a(()=>[o(m,{key:"opcion",props:e,"auto-width":""},{default:a(()=>[e.row.status=="ACTIVO"?(f(),b(q,{key:0,dense:"",icon:"more_vert",align:"right",label:"Opciones","no-caps":"",color:e.row.tipo_venta=="INGRESO"?"green-9":"red-9",size:"10px"},{default:a(()=>[S((f(),b(E,{clickable:"",class:"text-center"},{default:a(()=>[o(h,{dense:"",label:"Anular",color:"red-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"o_highlight_off",onClick:u=>c.saleAnular(e.row.id)},{default:a(()=>[o(v,null,{default:a(()=>[r("Anular venta")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[V]]),S((f(),b(E,{clickable:"",class:"text-center"},{default:a(()=>[o(h,{dense:"",label:"Imprimir",color:"green-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"print",onClick:u=>c.reimprimirNota(e.row)},{default:a(()=>[o(v,null,{default:a(()=>[r("Imprimir nota")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[V]])]),_:2},1032,["color"])):(f(),x("div",de,[o(N,{label:"Anulado",color:"grey-4","text-color":"white",dense:"",flat:""}),e.row.motivo_anulacion?(f(),b(h,{key:0,dense:"",color:"red-4",size:"10px","no-caps":"","no-wrap":"",icon:"visibility",onClick:u=>l.$alert.dialogShow(e.row.motivo_anulacion)},{default:a(()=>[o(v,null,{default:a(()=>[r("Motivo de anulaci\xF3n")]),_:1})]),_:2},1032,["onClick"])):y("",!0)]))]),_:2},1032,["props"]),o(m,{key:"proveedorcliente",props:e},{default:a(()=>{var u,_;return[e.row.client?(f(),x("div",ue,d((u=e.row.client)==null?void 0:u.name)+" "+d((_=e.row.client)==null?void 0:_.lastname),1)):y("",!0)]}),_:2},1032,["props"]),o(m,{key:"montoTotal",props:e,class:"text-right"},{default:a(()=>[s("span",{class:k(`text-${e.row.tipo_venta=="INGRESO"?"green":"red"}-7 text-bold`)},d(e.row.total)+" $ ",3)]),_:2},1032,["props"]),o(m,{key:"fechayhora",props:e,style:{"min-width":"150px"}},{default:a(()=>[r(d(l.$filters.dateDmYHis(e.row.date)),1)]),_:2},1032,["props"]),o(m,{key:"concepto",props:e,class:""},{default:a(()=>{var u,_;return[s("div",null,[o(h,{icon:"o_local_atm",size:"15px",color:`${e.row.tipo_venta=="INGRESO"?"green":"red"}-7`,class:k(`bg-${e.row.tipo_venta=="INGRESO"?"green":"red"}-2`),dense:"",flat:"",style:{padding:"0px",margin:"0px","border-radius":"0px",position:"absolute",top:"5px",left:"0px"}},null,8,["color","class"]),s("div",pe,[s("div",me,d(e.row.description)+" "+d((_=(u=e.row)==null?void 0:u.boat)==null?void 0:_.name),1)])])]}),_:2},1032,["props"]),o(m,{key:"observacion",props:e},{default:a(()=>[s("div",fe,d(e.row.observacion),1)]),_:2},1032,["props"]),o(m,{key:"pago",props:e},{default:a(()=>[o(N,{color:`${e.row.pago=="EFECTIVO"?"blue":"green"}-5`,"text-color":"white",dense:"",flat:"",label:e.row.pago},null,8,["color","label"])]),_:2},1032,["props"]),o(m,{key:"numeroFactura",props:e},{default:a(()=>[s("p",he,d(e.row.numeroFactura),1)]),_:2},1032,["props"]),o(m,{key:"user",props:e},{default:a(()=>{var u;return[s("p",null,d((u=e.row.user)==null?void 0:u.name),1)]}),_:2},1032,["props"]),o(m,{key:"lugar",props:e},{default:a(()=>[s("p",null,d(e.row.lugar),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["columns","rows","filter","loading"])])])]),_:1}),o(U,{modelValue:i.gastoDialog,"onUpdate:modelValue":n[4]||(n[4]=e=>i.gastoDialog=e),position:"right",maximized:""},{default:a(()=>[o(Q,{onGastoCreated:c.gastoCreated},null,8,["onGastoCreated"])]),_:1},8,["modelValue"]),ge],64)}var Ue=O(K,[["render",_e]]);export{Ue as default};
