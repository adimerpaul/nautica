import{_ as C,Q as c,R as D,S as d,V as e,T as l,aB as m,W as r,U as h,Y as f,Z as F,$ as k,aC as b,aE as v,a0 as V,aT as Q,aD as U,a4 as w}from"./index.d0cdc383.js";import{Q as B}from"./QMarkupTable.8263b7a1.js";import{Q as Y}from"./QSelect.0793eb75.js";import{Q as A}from"./QForm.54665059.js";import{Q as q}from"./QPage.ef29aaa2.js";import{h as y}from"./moment.40bc58bf.js";import"./QChip.dfad0562.js";import"./format.2cae61da.js";const S={name:"BoatDetails",data(){return{boat:{},file:{},dialog:!1,imageUrl:null,loading:!1,tipo:""}},async created(){this.boatGet()},methods:{editFile(t){this.file=t,this.tipo="Editar",this.dialog=!0},deleteFile(t){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar el archivo?").onOk(()=>{this.deleteFileConfirm(t)})},deleteFileConfirm(t){this.$axios.delete(`boatsFile/${t}`).then(i=>{this.boat=i.data})},onFileChange(t){const i=t.target.files[0];this.imageUrl=i},boatGet(){this.$axios.get(`boats/${this.$route.params.id}`).then(t=>{this.boat=t.data})},storeFile(){this.tipo==="Crear"?this.storeFileCreate():this.storeFileUpdate()},storeFileCreate(){if(!this.imageUrl)return this.$alert.error("Archivo es requerido"),!1;const t=new FormData;t.append("documento",this.file.documento),t.append("anio",this.file.anio),t.append("fecha",this.file.fecha),t.append("archivo",this.imageUrl),this.loading=!0,this.$axios.post(`boatsFile2/${this.boat.id}`,t).then(i=>{this.boat=i.data,this.dialog=!1,this.boatGet()}).finally(()=>{this.loading=!1})},storeFileUpdate(){this.loading=!0,this.$axios.put(`boatsFile/${this.file.id}`,{documento:this.file.documento,anio:this.file.anio,fecha:this.file.fecha}).then(t=>{this.boat=t.data,this.dialog=!1,this.boatGet()}).finally(()=>{this.loading=!1})},fileUpload(t){t.target&&t.target.files&&t.target.files.length>0?this.file.archivo=t.target.files[0]:console.error("No se pudo cargar el archivo correctamente.")},createClick(){this.dialog=!0,this.imageUrl=null,this.tipo="Crear",this.file={documento:"",archivo:null,anio:y().format("YYYY"),fecha:y().format("YYYY-MM-DD")}},diffDays(t){if(!t)return"";const i=new Date(t)-new Date;return Math.ceil(i/(1e3*60*60*24))},updateBoat(){this.$axios.put(`boats/${this.boat.id}`,this.boat).then(t=>{this.boat=t.data})},uploadBoat(t,i){this.file=i.target.files[0];const u=new FormData;u.append("file",this.file),u.append("field",t),this.$axios.post(`boatsFile/${this.boat.id}`,u).then(p=>{this.boat=p.data})}}},E={class:"row"},G={class:"col-12"},N=e("div",{class:"text-caption"},"Nombre",-1),T={class:"text-subtitle1"},M={class:"row"},I={class:"col-12 col-md-4"},L=e("div",{class:"text-caption"},"Empresa",-1),O={class:"text-subtitle1"},z={class:"col-12 col-md-4"},P=e("div",{class:"text-caption"},"Direcci\xF3n",-1),R={class:"text-subtitle1"},W={class:"col-12 col-md-4"},Z=e("div",{class:"text-caption"},"Tel\xE9fono Compania",-1),j={class:"text-subtitle1"},H={class:"col-12 text-right q-pa-xs"},J={class:"col-12"},K=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"Opciones"),e("th",null,"Documento"),e("th",null,"Archivo"),e("th",null,"A\xF1o"),e("th",null,"Fecha de vencimiento"),e("th",null,"Dias para vecimiento")])],-1),X={style:{width:"100px"}},$={key:1,class:"text-negative"},ee={class:"text-white"};function te(t,i,u,p,o,n){return c(),D(q,{class:"q-pa-xs bg-grey-3"},{default:d(()=>[e("div",E,[e("div",G,[l(b,null,{default:d(()=>[l(m,{class:"q-pa-md bg-primary text-white"},{default:d(()=>[N,e("div",T,r(o.boat.name),1)]),_:1}),l(m,{class:"q-pa-xs"},{default:d(()=>{var a,g,_;return[e("div",M,[e("div",I,[L,e("div",O,r((a=o.boat.company)==null?void 0:a.name),1)]),e("div",z,[P,e("div",R,r((g=o.boat.company)==null?void 0:g.address),1)]),e("div",W,[Z,e("div",j,r((_=o.boat.company)==null?void 0:_.phone),1)]),e("div",H,[l(h,{icon:"add_circle",label:"Agregar Documento",color:"green",onClick:n.createClick,"no-caps":""},null,8,["onClick"])]),e("div",J,[l(B,{dense:""},{default:d(()=>[K,e("tbody",null,[(c(!0),f(k,null,F(o.boat.files,s=>(c(),f("tr",{key:s.id},[e("td",X,[l(h,{icon:"delete",dense:"",flat:"",color:"negative",onClick:x=>n.deleteFile(s.id)},null,8,["onClick"]),l(h,{icon:"edit",dense:"",flat:"",color:"primary",onClick:x=>n.editFile(s)},null,8,["onClick"])]),e("td",null,r(s.documento),1),e("td",null,[l(h,{icon:"visibility",dense:"",flat:"",href:t.$url+"../files/"+s.file,type:"a",target:"_blank"},null,8,["href"]),e("span",null,r(s.name),1)]),e("td",null,r(s.anio),1),e("td",null,r(s.fecha),1),e("td",null,[n.diffDays(s.fecha)>0?(c(),f("span",{key:0,class:w({"text-positive":n.diffDays(s.fecha)>60,"text-warning":n.diffDays(s.fecha)<=60&&n.diffDays(s.fecha)>30,"text-negative":n.diffDays(s.fecha)<=30})},r(n.diffDays(s.fecha)),3)):(c(),f("span",$," Vencido "))])]))),128))])]),_:1})])])]}),_:1})]),_:1})])]),l(U,{modelValue:o.dialog,"onUpdate:modelValue":i[5]||(i[5]=a=>o.dialog=a)},{default:d(()=>[l(b,null,{default:d(()=>[l(m,{class:"bg-primary"},{default:d(()=>[e("div",ee,r(o.tipo)+" Documento",1)]),_:1}),l(m,null,{default:d(()=>[l(A,{onSubmit:n.storeFile},{default:d(()=>[l(Y,{modelValue:o.file.documento,"onUpdate:modelValue":i[0]||(i[0]=a=>o.file.documento=a),label:"Documento",outlined:"",dense:"",options:["DIF","Autoridad","Licencia"],rules:[a=>!!a||"Seleccione un documento"]},null,8,["modelValue","rules"]),l(v,{modelValue:o.file.anio,"onUpdate:modelValue":i[1]||(i[1]=a=>o.file.anio=a),label:"A\xF1o",outlined:"",dense:"",rules:[a=>!!a||"A\xF1o es requerido"]},null,8,["modelValue","rules"]),l(v,{modelValue:o.file.fecha,"onUpdate:modelValue":i[2]||(i[2]=a=>o.file.fecha=a),label:"Fecha de vencimiento",type:"date",outlined:"",dense:"",rules:[a=>!!a||"Fecha de vencimiento es requerido"]},null,8,["modelValue","rules"]),o.tipo==="Crear"?(c(),f("input",{key:0,type:"file",onChange:i[3]||(i[3]=(...a)=>n.onFileChange&&n.onFileChange(...a))},null,32)):V("",!0),l(Q,{align:"right"},{default:d(()=>[l(h,{label:"Cancelar",color:"negative",onClick:i[4]||(i[4]=a=>o.dialog=!1),loading:o.loading},null,8,["loading"]),l(h,{label:"Guardar",color:"primary",type:"submit",loading:o.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ce=C(S,[["render",te]]);export{ce as default};
