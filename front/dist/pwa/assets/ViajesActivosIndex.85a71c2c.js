import{_ as E,Q as m,R as f,S as t,T as o,V as s,aE as r,U as p,aC as C,b9 as I,aB as D,W as x,Y as U,Z as F,$ as A,aT as S,L as Q,aD as Y,a0 as k}from"./index.566a0c7b.js";import{b as j,Q as L}from"./QTable.abefbb12.js";import{e as b}from"./QChip.9398b8f1.js";import{b as q,Q as V}from"./QSpace.65ca5a66.js";import{Q as O}from"./QMarkupTable.443ee27d.js";import{Q as M}from"./QForm.11af5cf4.js";import{Q as R}from"./QPage.d89092e2.js";import{C as T}from"./ClosePopup.444fbeb2.js";import{h}from"./moment.40bc58bf.js";import"./QList.d0687d1b.js";import"./use-fullscreen.95c59374.js";import"./format.2cae61da.js";const B={name:"ViajesActivosIndex",data(){return{fechaInicio:h().startOf("month").format("YYYY-MM-DD"),fechaFin:h().endOf("month").format("YYYY-MM-DD"),columns:[{name:"option",label:"Opciones",align:"left",field:i=>i.option},{name:"id",label:"ID",align:"left",field:i=>i.id},{name:"name",label:"Empresa",align:"left",field:i=>{var e,n;return(n=(e=i==null?void 0:i.boat)==null?void 0:e.company)==null?void 0:n.name}},{name:"boat",label:"Barco",align:"left",field:i=>{var e;return(e=i==null?void 0:i.boat)==null?void 0:e.name}},{name:"zarpe",label:"Zarpe",align:"left",field:i=>i.zarpe},{name:"dias",label:"D\xEDas",align:"left",field:i=>i.dias},{name:"fechaInicio",label:"Fecha Inicio",align:"left",field:i=>this.$filters.formatdMY(i.fechaInicio)},{name:"fechaFin",label:"Fecha Fin",align:"left",field:i=>this.$filters.formatdMY(i.fechaFin)},{name:"status",label:"Estado",align:"left",field:i=>i.status}],loading:!1,moment:h,viajes:[],viaje:{},viajeDialog:!1,clienDialogHistory:!1,filter:"",passwordShow:!1,boats:[],crewViajes:[{crew_id:"",cargo:""}],crews:[]}},mounted(){this.crewsGet(),this.viajeActivosGet(),this.boatsGet()},methods:{crewsGet(){this.loading=!0,this.$axios.get("crews").then(i=>{this.crews=i.data}).catch(i=>{this.$alert.error(i.response.data.message)}).finally(()=>{this.loading=!1})},caculoDias(){if(this.viaje.fechaInicio&&this.viaje.fechaFin){const i=h(this.viaje.fechaFin).diff(h(this.viaje.fechaInicio),"days");this.viaje.dias=i}},boatsGet(){this.loading=!0,this.$axios.get("boats").then(i=>{this.boats=i.data}).catch(i=>{this.$alert.error(i.response.data.message)}).finally(()=>{this.loading=!1})},viajeSave(){const i=this.crewViajes.map(e=>e.crew_id);if(i.length!==new Set(i).size){this.$alert.error("No puede agregar tripulantes repetidos"),this.loading=!1;return}if(this.crewViajes.some(e=>!e.crew_id)){this.$alert.error("Debe seleccionar un tripulante"),this.loading=!1;return}this.viaje.crews=this.crewViajes,this.loading=!0,this.viaje.id?this.$axios.put(`viajes/${this.viaje.id}`,this.viaje).then(e=>{this.viajeDialog=!1;const n=this.viajes.findIndex(d=>d.id===this.viaje.id);this.viajes.splice(n,1,e.data)}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1}):this.$axios.post("viajes",this.viaje).then(e=>{this.viajeDialog=!1,this.viajes.unshift(e.data)}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},viajeClose(i){this.$alert.confirm("\xBFEst\xE1 seguro de cerrar este viaje?").onOk(()=>{this.loading=!0,this.$axios.put(`viajes/${i.id}/close`).then(e=>{const n=this.viajes.findIndex(d=>d.id===e.data.id);this.viajes.splice(n,1,e.data)}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})})},listaTripulantes(i){this.loading=!0,this.$axios.get(`listaTripulantes/${i.id}`,{responseType:"blob"}).then(e=>{const n=window.URL.createObjectURL(new Blob([e.data],{type:"application/pdf"})),d=window.document.createElement("a");d.href=n,d.setAttribute("download",`listaTripulantes-${i.id}.pdf`),window.document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(n)}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},addProducts(i){this.$router.push("/viajesShow/"+i.id)},viajeDelete(i){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este viaje?").onOk(()=>{this.loading=!0,this.$axios.delete(`viajes/${i.id}`).then(e=>{const n=this.viajes.findIndex(d=>d.id===e.data.id);console.log(n),n!==-1&&this.viajes.splice(n,1)}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})})},viajeClick(i,e){this.$router.push("/viajesConciliacion/"+e.id)},viajeEdit(i){this.viajeDialog=!0,this.viaje={...i},this.crewViajes=[],i.crews.forEach(e=>{this.crewViajes.push({crew_id:e.id,cargo:e.pivot.role})}),this.crewViajes.length===0&&(this.crewViajes=[{crew_id:"",cargo:""}])},viajeAdd(){this.crewViajes=[{crew_id:"",cargo:""}],this.viajeDialog=!0,this.viaje={fechaInicio:h().format("YYYY-MM-DD"),fechaFin:h().add(1,"month").format("YYYY-MM-DD"),boat_id:"",observaciones:"",hora:h().format("HH:00"),dias:"",zarpe:"",puertoSalida:"MUELLE DE PESCA, PUERTO EL TRIUNFO",puertoLlegada:"MUELLE DE PESCA, PUERTO EL TRIUNFO",bandera:"SALVADORE\xD1A ESA-00283 (ARB 90.74 TM)",propietario:"LA REYNAGA MORENO, S.A. DE C.V."},this.caculoDias()},viajeActivosGet(){this.loading=!0,this.$axios.get("viajesActivos",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}}).then(i=>{this.viajes=i.data}).catch(i=>{this.$alert.error(i.response.data.message)}).finally(()=>{this.loading=!1})}}},P={class:"row"},G={class:"col-6 col-md-2 q-pa-xs"},N={class:"col-6 col-md-2 q-pa-xs"},z={class:"col-12 col-md-3 q-pa-xs"},H={class:"col-12 col-md-5 q-pa-xs text-right"},Z={class:"text-h6"},W={class:"row"},J={class:"col-6 col-md-3"},K={class:"col-6 col-md-3"},X={class:"col-6 col-md-3"},$={class:"col-6 col-md-3"},ee={class:"col-12 col-md-6"},le={class:"col-12 col-md-6"},ie={class:"col-12 col-md-6"},ae={class:"col-12 col-md-6"},oe={class:"col-12 col-md-6"},se={class:"col-12 col-md-6"},te={class:"col-12"},ne=s("thead",null,[s("tr",null,[s("th",null,"#"),s("th",null,"Nombre"),s("th",null,"Cargo"),s("th",null,"Opciones")])],-1);function de(i,e,n,d,a,v){return m(),f(R,{class:"bg-grey-3 q-pa-xs"},{default:t(()=>[o(C,null,{default:t(()=>[s("div",P,[s("div",G,[o(r,{modelValue:a.fechaInicio,"onUpdate:modelValue":e[0]||(e[0]=l=>a.fechaInicio=l),label:"Fecha Inicio",type:"date",outlined:"",dense:"",loading:a.loading},null,8,["modelValue","loading"])]),s("div",N,[o(r,{modelValue:a.fechaFin,"onUpdate:modelValue":e[1]||(e[1]=l=>a.fechaFin=l),label:"Fecha Fin",type:"date",outlined:"",dense:"",loading:a.loading},null,8,["modelValue","loading"])]),s("div",z,[o(r,{modelValue:a.filter,"onUpdate:modelValue":e[2]||(e[2]=l=>a.filter=l),label:"Buscar",outlined:"",dense:"",loading:a.loading},null,8,["modelValue","loading"])]),s("div",H,[o(p,{color:"indigo",label:"Buscar",onClick:v.viajeActivosGet,"no-caps":"",icon:"search",loading:a.loading},null,8,["onClick","loading"])])])]),_:1}),o(L,{rows:a.viajes,columns:a.columns,"rows-per-page-options":[0],"row-key":"id",dense:"",filter:a.filter,loading:a.loading,onRowClick:v.viajeClick},{"body-cell-option":t(l=>[o(j,{"auto-width":""},{default:t(()=>[(m(),f(p,{label:"Consiliacion",color:"primary","auto-close":"","no-caps":"",style:{width:"120px"},size:"10px",icon:"check_circle",key:l.row.id}))]),_:2},1024)]),"body-cell-name":t(l=>[o(j,{props:l},{default:t(()=>{var c,u,g,w,y,_;return[o(b,{label:(g=(u=(c=l.row)==null?void 0:c.boat)==null?void 0:u.company)==null?void 0:g.name,"text-color":"white",style:I({backgroundColor:(_=(y=(w=l.row)==null?void 0:w.boat)==null?void 0:y.company)==null?void 0:_.color}),icon:"business"},null,8,["label","style"])]}),_:2},1032,["props"])]),"body-cell-status":t(l=>[o(j,{props:l},{default:t(()=>{var c,u,g;return[((c=l.row)==null?void 0:c.estado)==="Activo"?(m(),f(b,{key:0,label:(u=l.row)==null?void 0:u.estado,"text-color":"white",dense:"",color:"green"},null,8,["label"])):(m(),f(b,{key:1,label:(g=l.row)==null?void 0:g.estado,"text-color":"white",dense:"",color:"red"},null,8,["label"]))]}),_:2},1032,["props"])]),_:1},8,["rows","columns","filter","loading","onRowClick"]),o(Y,{modelValue:a.viajeDialog,"onUpdate:modelValue":e[15]||(e[15]=l=>a.viajeDialog=l),persistent:""},{default:t(()=>[o(C,{style:{width:"650px","max-width":"95vw"}},{default:t(()=>[o(D,{class:"row items-center q-pb-none"},{default:t(()=>[s("div",Z,x(a.viaje.id?"Editar":"Agregar")+" Viaje",1),o(q),o(p,{flat:"",dense:"",icon:"close",onClick:e[3]||(e[3]=l=>a.viajeDialog=!1)})]),_:1}),o(M,{onSubmit:v.viajeSave},{default:t(()=>[o(D,null,{default:t(()=>[s("div",W,[s("div",J,[o(r,{modelValue:a.viaje.fechaInicio,"onUpdate:modelValue":[e[4]||(e[4]=l=>a.viaje.fechaInicio=l),v.caculoDias],label:"Fecha Inicio",type:"date",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules","onUpdate:modelValue"])]),s("div",K,[o(r,{modelValue:a.viaje.fechaFin,"onUpdate:modelValue":[e[5]||(e[5]=l=>a.viaje.fechaFin=l),v.caculoDias],label:"Fecha Fin",type:"date",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido",l=>a.moment(l).isSameOrAfter(a.viaje.fechaInicio)||"La fecha debe ser mayor o igual a la fecha de inicio"]},null,8,["modelValue","rules","onUpdate:modelValue"])]),s("div",X,[o(r,{modelValue:a.viaje.hora,"onUpdate:modelValue":e[6]||(e[6]=l=>a.viaje.hora=l),label:"Hora",outlined:"",dense:"",type:"time",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),s("div",$,[o(r,{modelValue:a.viaje.dias,"onUpdate:modelValue":e[7]||(e[7]=l=>a.viaje.dias=l),label:"D\xEDas",outlined:"",dense:"",type:"number",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),s("div",ee,[o(r,{modelValue:a.viaje.zarpe,"onUpdate:modelValue":e[8]||(e[8]=l=>a.viaje.zarpe=l),label:"Zarpe",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),s("div",le,[o(V,{modelValue:a.viaje.boat_id,"onUpdate:modelValue":e[9]||(e[9]=l=>a.viaje.boat_id=l),options:a.boats,label:"Barco",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"],"map-options":"","emit-value":"","option-value":"id","option-label":"name"},null,8,["modelValue","options","rules"])]),s("div",ie,[o(r,{modelValue:a.viaje.puertoSalida,"onUpdate:modelValue":e[10]||(e[10]=l=>a.viaje.puertoSalida=l),label:"Puerto de Salida",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),s("div",ae,[o(r,{modelValue:a.viaje.puertoLlegada,"onUpdate:modelValue":e[11]||(e[11]=l=>a.viaje.puertoLlegada=l),label:"Puerto de Llegada",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),s("div",oe,[o(r,{modelValue:a.viaje.bandera,"onUpdate:modelValue":e[12]||(e[12]=l=>a.viaje.bandera=l),label:"Bandera",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),s("div",se,[o(r,{modelValue:a.viaje.propietario,"onUpdate:modelValue":e[13]||(e[13]=l=>a.viaje.propietario=l),label:"Propietario",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),s("div",te,[o(O,{flat:"",bordered:"",dense:"","wrap-cells":""},{default:t(()=>[ne,s("tbody",null,[(m(!0),U(A,null,F(a.crewViajes,(l,c)=>(m(),U("tr",{key:c},[s("td",null,x(c+1),1),s("td",null,[o(V,{modelValue:l.crew_id,"onUpdate:modelValue":u=>l.crew_id=u,options:a.crews,outlined:"",dense:"","map-options":"","emit-value":"","option-value":"id","option-label":"name"},null,8,["modelValue","onUpdate:modelValue","options"])]),s("td",null,[o(V,{modelValue:l.cargo,"onUpdate:modelValue":u=>l.cargo=u,options:i.$cargos,outlined:"",dense:"","value-field":"value","label-field":"label","map-options":"","emit-value":""},null,8,["modelValue","onUpdate:modelValue","options"])]),s("td",null,[a.crewViajes.length>1&&c!==a.crewViajes.length-1?(m(),f(p,{key:0,rounded:"",color:"red",dense:"",icon:"delete",onClick:u=>a.crewViajes.splice(c,1)},null,8,["onClick"])):k("",!0),c===a.crewViajes.length-1?(m(),f(p,{key:1,rounded:"",color:"green",dense:"",icon:"add",onClick:e[14]||(e[14]=u=>a.crewViajes.push({crew_id:"",cargo:""}))})):k("",!0)])]))),128))])]),_:1})])])]),_:1}),o(S,{align:"right"},{default:t(()=>[Q(o(p,{flat:"",label:"Cancelar",loading:a.loading,"no-caps":"",class:"text-bold"},null,8,["loading"]),[[T]]),o(p,{color:"primary",label:"Guardar",type:"submit",loading:a.loading,"no-caps":"",class:"text-bold"},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var we=E(B,[["render",de]]);export{we as default};
