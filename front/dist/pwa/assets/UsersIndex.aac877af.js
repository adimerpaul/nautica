import{_ as E,Q as t,R as n,S as a,T as e,L as c,ar as f,X as h,Z as g,U as m,aE as b,aC as k,aB as w,V as p,W as y,aT as Q,aD as S,b8 as A,a3 as _}from"./index.825c4de4.js";import{a as v,b as d,e as V}from"./QChip.8c428089.js";import{Q as N}from"./QBtnDropdown.e6fea592.js";import{b as D,Q as q}from"./QTable.fa8dcd2d.js";import{Q as R}from"./QTooltip.14cbf776.js";import{b as U,Q as B}from"./QSpace.f04f6d94.js";import{Q as P}from"./QForm.499c0c97.js";import{Q as G}from"./QPage.aba7e782.js";import{C as I}from"./ClosePopup.c32111f3.js";import"./QList.e4fc5a90.js";import"./QMarkupTable.c4884d75.js";import"./use-fullscreen.92788943.js";import"./format.2cae61da.js";const O={name:"ClientsIndex",data(){return{columns:[{name:"option",label:"Opciones",align:"left",field:s=>s.option},{name:"id",label:"ID",align:"left",field:s=>s.id},{name:"name",label:"Nombre",align:"left",field:s=>s.name},{name:"username",label:"Usuario",align:"left",field:s=>s.username},{name:"role",label:"Rol",align:"left",field:s=>s.role}],loading:!1,users:[],user:{},userDialog:!1,clienDialogHistory:!1,filter:"",passwordShow:!1,permisos:[],permisosSelected:[],dialogPermisos:!1}},mounted(){this.permissionGet(),this.userGet()},methods:{userPermisos(){this.loading=!0,this.$axios.put(`permissions/${this.user.id}`,{permissions:this.permisosSelected}).then(s=>{this.dialogPermisos=!1;const l=this.users.findIndex(r=>r.id===s.data.id);this.users.splice(l,1,s.data)}).catch(s=>{this.$alert.error(s.response.data.message)}).finally(()=>{this.loading=!1})},permisosUpdate(s){this.user=s,this.permisosSelected=s.permissions.map(l=>l.id),this.dialogPermisos=!0},permissionGet(){this.$axios.get("permissions").then(s=>{s.data.forEach(l=>{l.label=l.name,l.value=l.id}),this.permisos=s.data}).catch(s=>{this.$alert.error(s.response.data.message)})},userSave(){this.loading=!0,this.user.id?this.$axios.put(`users/${this.user.id}`,this.user).then(s=>{this.userDialog=!1;const l=this.users.findIndex(r=>r.id===this.user.id);this.users.splice(l,1,s.data)}).catch(s=>{this.$alert.error(s.response.data.message)}).finally(()=>{this.loading=!1}):this.$axios.post("users",this.user).then(s=>{this.userDialog=!1,this.users.unshift(s.data)}).catch(s=>{this.$alert.error(s.response.data.message)}).finally(()=>{this.loading=!1})},userChangePassword(s){this.$alert.promptPassword("Ingrese la nueva contrase\xF1a").onOk(l=>{this.loading=!0,this.$axios.put(`passwordUpdate/${s.id}`,{password:l}).then(r=>{this.$alert.success("Contrase\xF1a cambiada con \xE9xito")}).catch(r=>{this.$alert.error(r.response.data.message)}).finally(()=>{this.loading=!1})})},userDelete(s){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este usere?").onOk(()=>{this.loading=!0,this.$axios.delete(`users/${s.id}`).then(l=>{const r=this.users.findIndex(x=>x.id===l.data.id);r>-1&&this.users.splice(r,1)}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})})},userEdit(s){this.userDialog=!0,this.user={...s}},userAdd(){this.userDialog=!0,this.user={name:"",ci:""}},userGet(){this.loading=!0,this.$axios.get("users").then(s=>{this.users=s.data}).catch(s=>{this.$alert.error(s.response.data.message)}).finally(()=>{this.loading=!1})}}},T={class:"text-h6"},M={class:"row"},F={class:"col-12"},H={class:"col-12"},L={class:"col-12"},W={class:"col-12"},X={class:"text-h6"};function Z(s,l,r,x,i,u){return t(),n(G,{class:"bg-grey-3 q-pa-md"},{default:a(()=>[e(q,{rows:i.users,columns:i.columns,title:"Usuarios","rows-per-page-options":[0],"row-key":"id",dense:"",filter:i.filter,loading:i.loading},{"body-cell-option":a(o=>[e(D,{"auto-width":""},{default:a(()=>[e(N,{flat:"",dense:"","dropdown-icon":"more_vert","auto-close":""},{default:a(()=>[c((t(),n(v,{clickable:"",onClick:C=>u.userEdit(o.row)},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"edit"})]),_:1}),e(d,null,{default:a(()=>[h("Editar")]),_:1})]),_:2},1032,["onClick"])),[[_]]),c((t(),n(v,{clickable:"",onClick:C=>u.userDelete(o.row)},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"delete"})]),_:1}),e(d,null,{default:a(()=>[h("Eliminar")]),_:1})]),_:2},1032,["onClick"])),[[_]]),c((t(),n(v,{clickable:"",onClick:C=>u.userChangePassword(o.row)},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"vpn_key"})]),_:1}),e(d,null,{default:a(()=>[h("Cambiar Contrase\xF1a")]),_:1})]),_:2},1032,["onClick"])),[[_]]),c((t(),n(v,{clickable:"",onClick:C=>u.permisosUpdate(o.row)},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"verified_user"})]),_:1}),e(d,null,{default:a(()=>[h("Permisos")]),_:1})]),_:2},1032,["onClick"])),[[_]])]),_:2},1024)]),_:2},1024)]),"body-cell-role":a(o=>[e(D,{props:o},{default:a(()=>[o.row.role==="VENDEDOR"?(t(),n(V,{key:0,dense:"",label:"Vendedor",color:"orange","text-color":"white",icon:"account_circle"})):g("",!0),o.row.role==="ADMIN"?(t(),n(V,{key:1,dense:"",label:"Admin",color:"indigo","text-color":"white",icon:"account_circle"})):g("",!0),o.row.role==="SUPERADMIN"?(t(),n(V,{key:2,dense:"",label:"Super admin",color:"purple","text-color":"white",icon:"account_circle"})):g("",!0)]),_:2},1032,["props"])]),"top-right":a(()=>[e(m,{outline:"",dense:"",icon:"add_circle",onClick:u.userAdd,label:"Agregar","no-caps":"",loading:i.loading},{default:a(()=>[e(R,null,{default:a(()=>[h("Agregar")]),_:1})]),_:1},8,["onClick","loading"]),e(b,{modelValue:i.filter,"onUpdate:modelValue":l[0]||(l[0]=o=>i.filter=o),dense:"",class:"q-ml-md",debounce:"300",placeholder:"Buscar",outlined:"",clearable:""},{append:a(()=>[e(f,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter","loading"]),e(S,{modelValue:i.userDialog,"onUpdate:modelValue":l[7]||(l[7]=o=>i.userDialog=o),persistent:""},{default:a(()=>[e(k,{style:{width:"250px","max-width":"90vw"}},{default:a(()=>[e(w,{class:"row items-center q-pb-none"},{default:a(()=>[p("div",T,y(i.user.id?"Editar":"Agregar")+" Usuario",1),e(U),e(m,{flat:"",dense:"",icon:"close",onClick:l[1]||(l[1]=o=>i.userDialog=!1)})]),_:1}),e(P,{onSubmit:u.userSave},{default:a(()=>[e(w,null,{default:a(()=>[p("div",M,[p("div",F,[e(b,{modelValue:i.user.name,"onUpdate:modelValue":l[2]||(l[2]=o=>i.user.name=o),label:"Nombre",outlined:"",dense:"",rules:[o=>!!o||"Campo requerido"]},null,8,["modelValue","rules"])]),p("div",H,[e(b,{modelValue:i.user.username,"onUpdate:modelValue":l[3]||(l[3]=o=>i.user.username=o),label:"Usuario",outlined:"",dense:"",rules:[o=>!!o||"Campo requerido"]},null,8,["modelValue","rules"])]),p("div",L,[i.user.id?g("",!0):(t(),n(b,{key:0,modelValue:i.user.password,"onUpdate:modelValue":l[5]||(l[5]=o=>i.user.password=o),label:"Contrase\xF1a",outlined:"",dense:"",rules:[o=>!!o||"Campo requerido"],type:i.passwordShow?"text":"password"},{append:a(()=>[e(f,{name:i.passwordShow?"visibility":"visibility_off",onClick:l[4]||(l[4]=o=>i.passwordShow=!i.passwordShow)},null,8,["name"])]),_:1},8,["modelValue","rules","type"]))]),p("div",W,[e(B,{modelValue:i.user.role,"onUpdate:modelValue":l[6]||(l[6]=o=>i.user.role=o),label:"Rol",outlined:"",dense:"",options:[{label:"Vendedor",value:"VENDEDOR"},{label:"Admin",value:"ADMIN"},{label:"Super Admin",value:"SUPERADMIN"}],rules:[o=>!!o||"Campo requerido"],"emit-value":"","map-options":""},null,8,["modelValue","rules"])])])]),_:1}),e(Q,{align:"right"},{default:a(()=>[c(e(m,{flat:"",label:"Cancelar",loading:i.loading},null,8,["loading"]),[[I]]),e(m,{color:"primary",label:"Guardar",type:"submit",loading:i.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),e(S,{modelValue:i.dialogPermisos,"onUpdate:modelValue":l[10]||(l[10]=o=>i.dialogPermisos=o)},{default:a(()=>[e(k,{style:{width:"450px","max-width":"90vw"}},{default:a(()=>[e(w,{class:"row items-center q-pb-none"},{default:a(()=>[p("div",X,"Permisos de "+y(i.user.name),1),e(U),e(m,{flat:"",dense:"",icon:"close",onClick:l[8]||(l[8]=o=>i.dialogPermisos=!1)})]),_:1}),e(P,{onSubmit:u.userPermisos},{default:a(()=>[e(w,null,{default:a(()=>[e(A,{modelValue:i.permisosSelected,"onUpdate:modelValue":l[9]||(l[9]=o=>i.permisosSelected=o),options:i.permisos,dense:"",type:"checkbox"},null,8,["modelValue","options"])]),_:1}),e(Q,{align:"right"},{default:a(()=>[c(e(m,{flat:"",label:"Cancelar",loading:i.loading},null,8,["loading"]),[[I]]),e(m,{color:"primary",label:"Guardar",type:"submit",loading:i.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var te=E(O,[["render",Z]]);export{te as default};
