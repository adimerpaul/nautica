import{_ as E,P as F,Q as r,R as g,S as d,T as t,V as e,U as u,Z as v,W as h,b9 as G,aC as x,aB as b,X as I,aE as n,a0 as f,a2 as N,a1 as Y,aD as y}from"./index.019f517a.js";import{e as V}from"./QChip.c1672a5a.js";import{b as Q,Q as R}from"./QSpace.c2738bce.js";import{Q as H}from"./QMarkupTable.10eb4a66.js";import{Q as O}from"./QForm.50dfdfaa.js";import{l as T,Q as M}from"./lodash.d8d8f4ac.js";import{Q as z}from"./QPage.25c125fb.js";import{h as p}from"./moment.40bc58bf.js";import{D as J}from"./DialogGasto.25ae48cb.js";import"./format.2cae61da.js";import"./QBtnDropdown.dc9074a5.js";import"./QTooltip.26793da5.js";import"./use-fullscreen.7bc4a682.js";import"./_commonjsHelpers.48c1ef9f.js";import"./ClosePopup.e4344b62.js";const W={name:"ViajesShow",components:{DialogGasto:J},data(){return{id:"",viaje:{observaciones:""},gastoDialog:!1,debouncedUpdateObservaciones:null,dialogAgregarProducto:!1,products:[],productsAll:[],product:"",cantidad:"",loading:!1,productViaje:[],productBuy:[],descargar:{viaje_id:"",descarga:"",dia:"",fecha:""},lanceDialog:!1,lance:{},lances:[]}},mounted(){this.id=this.$route.params.id,this.getViaje(),this.debouncedUpdateObservaciones=T.exports.debounce(this.updateObservaciones,1e3),this.productsGet()},methods:{eliminarLance(a){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este lance?").onOk(()=>{this.loading=!0,this.$axios.delete(`lances/${a.id}`).then(o=>{this.lances=this.lances.filter(i=>i.id!==a.id)}).catch(o=>{console.log(o)}).finally(()=>{this.loading=!1})})},lanceSave(){this.loading=!0,this.$axios.post("lances",this.lance).then(a=>{this.lances.push(a.data),this.lanceDialog=!1}).catch(a=>{console.log(a)}).finally(()=>{this.loading=!1})},agregarLance(){this.lanceDialog=!0,this.lance={viaje_id:this.id,fecha:p().format("YYYY-MM-DD"),numero:this.lances.length+1,hora_inicio:p().format("HH:mm"),hora_fin:p().format("HH:mm"),latitud:"",longitud:"",camaron_blanco:"",camaron_cafe:"",camaron_rojo:"",camaroncillo:"",calamar:"",caracol:"",corvina:"",babosa:"",guabina:"",jaiba:"",langosta:"",pulpo:"",jurel:"",anguila:"",pargo:"",robalo:"",cienero:"",otras_especies:"",observaciones:""}},gastoCreated(a){this.gastoDialog=!1},agregarProducto(){if(this.product==="")return this.$alert.error("Seleccione un producto"),!1;if(this.cantidad==="")return this.$alert.error("Ingrese una cantidad"),!1;if(this.productBuy.find(o=>o.id===this.product.id))return this.$alert.error("El producto ya fue agregado"),!1;this.productBuy.push({id:this.product.id,name:this.product.name,stock:this.cantidad}),this.product="",this.cantidad=""},imprimirPdfTotal(){this.loading=!0,this.$axios.get("exportDescargarPdfTotal/"+this.id,{responseType:"blob"}).then(a=>{const o=window.URL.createObjectURL(new Blob([a.data])),i=document.createElement("a");i.href=o,i.setAttribute("download","descarga.pdf"),document.body.appendChild(i),i.click()}).catch(a=>{console.log(a)}).finally(()=>{this.loading=!1})},imprimirPdf(a){this.loading=!0,this.$axios.get("exportDescargarPdf/"+a.id,{responseType:"blob"}).then(o=>{const i=window.URL.createObjectURL(new Blob([o.data])),c=document.createElement("a");c.href=i,c.setAttribute("download","descarga.pdf"),document.body.appendChild(c),c.click()}).catch(o=>{console.log(o)}).finally(()=>{this.loading=!1})},anular(a){this.$alert.confirm("\xBFEst\xE1 seguro de anular este producto?").onOk(()=>{this.loading=!0,this.$axios.put(`productAnular/${a.id}`).then(o=>{this.productViaje=this.productViaje.map(i=>(i.id===a.id&&(i.status="INACTIVO"),i))}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})})},productAdd(){this.loading=!0,this.$axios.post("productAdd",{products:this.productBuy,descarga:this.descargar}).then(a=>{this.dialogAgregarProducto=!1,this.$alert.success("Producto agregado"),this.getViaje()}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},filterFn(a,o,i){if(a===""){o(()=>{this.products=this.productsAll});return}const c=a.toLowerCase();o(()=>{this.products=this.productsAll.filter(l=>l.name.toLowerCase().indexOf(c)>-1)})},productsGet(){this.$axios.get("products").then(a=>{this.products=a.data,this.productsAll=a.data}).catch(a=>{console.log(a)})},dialogAgregarProductoClick(){var c;const a=p((c=this.viaje)==null?void 0:c.fechaInicio),i=p().diff(a,"days");this.dialogAgregarProducto=!0,this.product="",this.cantidad="",this.descargar={viaje_id:this.id,descarga:this.productViaje.length+1,dia:i+1,fecha:p().format("YYYY-MM-DD")},this.productBuy=[]},updateObservaciones(a){this.$axios.put(`updateObservaciones/${this.id}`,{observaciones:a}).then(o=>{}).catch(o=>{console.log(o)})},getViaje(){this.loading=!0,this.$axios.get(`viajes/${this.id}`).then(a=>{this.viaje=a.data.viaje,this.productViaje=a.data.productoViaje,this.lances=a.data.lances}).catch(a=>{console.log(a)}).finally(()=>{this.loading=!1})}}},X={class:"row"},Z=e("div",{class:"col-12"},[e("div",{class:"text-h5 text-center bg-primary text-white"},"Concolidados")],-1),K={class:"col-6 col-md-2 q-pa-xs"},$={class:"col-6 col-md-2 q-pa-xs"},ee=e("label",{class:"text-bold"},"Viaje",-1),oe=e("br",null,null,-1),le={class:"col-6 col-md-2 q-pa-xs"},se=e("label",{class:"text-bold"},"Fechas",-1),te={class:"col-6 col-md-2 q-pa-xs"},ae=e("label",{class:"text-bold"},"Barco",-1),ne={class:"col-6 col-md-2 q-pa-xs"},ie=e("label",{class:"text-bold"},"Empresa",-1),de=e("br",null,null,-1),ce=e("div",{class:"col-6 col-md-2 q-pa-xs q-mt-md"},null,-1),re=e("div",{class:"col-12 col-md-3 q-pa-xs"},[e("div",{class:"bg-primary text-white text-h6 text-center"},"Descargas")],-1),ue=e("div",{class:"col-12 col-md-3 q-pa-xs"},[e("div",{class:"bg-primary text-white text-h6 text-center"},"Lances")],-1),me=e("div",{class:"col-12 col-md-3 q-pa-xs"},[e("div",{class:"bg-primary text-white text-h6 text-center"},"Ventas")],-1),he=e("div",{class:"col-12 col-md-3 q-pa-xs"},[e("div",{class:"bg-primary text-white text-h6 text-center"},"Inventario")],-1),pe={class:"text-subtitle2 text-bold"},_e={class:"row"},ge={class:"col-12 col-md-4 q-pa-xs"},be=e("label",{for:"Nro Descarga"},"Nro Descarga",-1),fe=e("br",null,null,-1),Ve={class:"col-12 col-md-4 q-pa-xs"},ve=e("label",{for:"Dia"},"Dia",-1),xe=e("br",null,null,-1),ye={class:"col-12 col-md-4 q-pa-xs"},je=e("label",{for:"Dia"},"Fecha",-1),Ce=e("br",null,null,-1),Ue={class:"col-12 col-md-6 q-pa-xs"},ke=e("label",{for:"Dia"},"Producto",-1),we=e("br",null,null,-1),De={class:"col-12 col-md-3 q-pa-xs"},Ae=e("label",{for:"Cantidad"},"Libras",-1),qe=e("br",null,null,-1),Pe={class:"col-12 col-md-3 text-center q-mt-md q-pa-xs"},Be={class:"col-12 q-mt-md"},Le=e("thead",{class:"bg-primary text-white"},[e("tr",null,[e("th",null,"Producto"),e("th",null,"Stock"),e("th",null,"Opcion")])],-1),Qe={key:0},Oe={class:"text-right"},Se={class:"text-right"},Ee={key:1},Fe=e("tr",null,[e("td",{colspan:"2",class:"text-center"},"No hay productos")],-1),Ge=[Fe],Ie={class:"col-12 text-right"},Ne=e("div",{class:"text-subtitle2 text-bold"},"Agregar Lance",-1),Ye={class:"row"},Re={class:"col-6 col-md-2"},He=e("label",{for:"Fecha"},"Fecha",-1),Te={class:"col-6 col-md-2"},Me=e("label",{for:"Hora Inicio"},"Hora Inicio",-1),ze={class:"col-6 col-md-2"},Je=e("label",{for:"Hora Fin"},"Hora Fin",-1),We={class:"col-6 col-md-2"},Xe=e("label",{for:"Nro"},"Nro",-1),Ze={class:"col-6 col-md-2"},Ke=e("label",{for:"Latitud"},"Latitud",-1),$e={class:"col-6 col-md-2"},eo=e("label",{for:"Longitud"},"Longitud",-1),oo={class:"col-6 col-md-2"},lo=e("label",{for:"Camaron Blanco"},"Camaron Blanco",-1),so={class:"col-6 col-md-2"},to=e("label",{for:"Camaron Cafe"},"Camaron Cafe",-1),ao={class:"col-6 col-md-2"},no=e("label",{for:"Camaron Rojo"},"Camaron Rojo",-1),io={class:"col-6 col-md-2"},co=e("label",{for:"Camaroncillo"},"Camaroncillo",-1),ro={class:"col-6 col-md-2"},uo=e("label",{for:"Calamar"},"Calamar",-1),mo={class:"col-6 col-md-2"},ho=e("label",{for:"Caracol"},"Caracol",-1),po={class:"col-6 col-md-2"},_o=e("label",{for:"Corvina"},"Corvina",-1),go={class:"col-6 col-md-2"},bo=e("label",{for:"Babosa"},"Babosa",-1),fo={class:"col-6 col-md-2"},Vo=e("label",{for:"Guabina"},"Guabina",-1),vo={class:"col-6 col-md-2"},xo=e("label",{for:"Jaiba"},"Jaiba",-1),yo={class:"col-6 col-md-2"},jo=e("label",{for:"Langosta"},"Langosta",-1),Co={class:"col-6 col-md-2"},Uo=e("label",{for:"Pulpo"},"Pulpo",-1),ko={class:"col-6 col-md-2"},wo=e("label",{for:"Jurel"},"Jurel",-1),Do={class:"col-6 col-md-2"},Ao=e("label",{for:"Anguila"},"Anguila",-1),qo={class:"col-6 col-md-2"},Po=e("label",{for:"Pargo"},"Pargo",-1),Bo={class:"col-6 col-md-2"},Lo=e("label",{for:"Robalo"},"Robalo",-1),Qo={class:"col-6 col-md-2"},Oo=e("label",{for:"Cienero"},"Cienero",-1),So={class:"col-6 col-md-2"},Eo=e("label",{for:"Otras Especies"},"Otras Especies",-1),Fo={class:"col-12"},Go=e("label",{for:"Observaciones"},"Observaciones",-1),Io={class:"col-12 text-right q-pt-xs"},No=e("div",{id:"myElement",class:"hidden"},null,-1);function Yo(a,o,i,c,l,m){const S=F("DialogGasto");return r(),g(z,{class:"bg-grey-3 q-pa-xs"},{default:d(()=>[t(x,null,{default:d(()=>{var s,_,j,C,U,k,w,D,A,q,P,B,L;return[e("div",X,[Z,e("div",K,[t(u,{color:"primary",label:"Volver",onClick:o[0]||(o[0]=()=>{this.$router.push("/viajesActivos")}),"no-caps":"",icon:"arrow_back",size:"sm",loading:l.loading},null,8,["loading"])]),e("div",$,[ee,oe,((s=l.viaje)==null?void 0:s.status)==="Finalizado"?(r(),g(V,{key:0,label:(_=l.viaje)==null?void 0:_.status,"text-color":"white",dense:"",color:"green"},null,8,["label"])):v("",!0),((j=l.viaje)==null?void 0:j.status)==="Pendiente"?(r(),g(V,{key:1,label:(C=l.viaje)==null?void 0:C.status,"text-color":"white",dense:"",color:"orange"},null,8,["label"])):v("",!0),((U=l.viaje)==null?void 0:U.status)==="En curso"?(r(),g(V,{key:2,label:(k=l.viaje)==null?void 0:k.status,"text-color":"white",dense:"",color:"blue"},null,8,["label"])):v("",!0)]),e("div",le,[se,e("div",null,h(a.$filters.formatdMY(l.viaje.fechaInicio))+" "+h(a.$filters.formatdMY(l.viaje.fechaFin)),1)]),e("div",te,[ae,e("div",null,h((w=l.viaje.boat)==null?void 0:w.name),1)]),e("div",ne,[ie,de,t(V,{size:"12px",label:(q=(A=(D=l.viaje)==null?void 0:D.boat)==null?void 0:A.company)==null?void 0:q.name,"text-color":"white",style:G({backgroundColor:(L=(B=(P=l.viaje)==null?void 0:P.boat)==null?void 0:B.company)==null?void 0:L.color}),icon:"business"},null,8,["label","style"])]),ce,re,ue,me,he])]}),_:1}),t(y,{modelValue:l.dialogAgregarProducto,"onUpdate:modelValue":o[7]||(o[7]=s=>l.dialogAgregarProducto=s)},{default:d(()=>[t(x,{style:{width:"750px","max-width":"95vh"}},{default:d(()=>[t(b,{class:"row items-center q-pb-none"},{default:d(()=>{var s;return[e("div",pe,"Descarga "+h((s=l.viaje.boat)==null?void 0:s.name),1),t(Q),t(u,{flat:"",round:"",dense:"",icon:"close",onClick:o[1]||(o[1]=()=>{l.dialogAgregarProducto=!1})}),I("\xA1 ")]}),_:1}),t(O,{onSubmit:m.productAdd},{default:d(()=>[t(b,null,{default:d(()=>[e("div",_e,[e("div",ge,[be,fe,t(n,{modelValue:l.descargar.descarga,"onUpdate:modelValue":o[2]||(o[2]=s=>l.descargar.descarga=s),outlined:"",filled:"",dense:""},null,8,["modelValue"])]),e("div",Ve,[ve,xe,t(n,{modelValue:l.descargar.dia,"onUpdate:modelValue":o[3]||(o[3]=s=>l.descargar.dia=s),outlined:"",filled:"",dense:""},null,8,["modelValue"])]),e("div",ye,[je,Ce,t(n,{modelValue:l.descargar.fecha,"onUpdate:modelValue":o[4]||(o[4]=s=>l.descargar.fecha=s),outlined:"",type:"date",filled:"",dense:""},null,8,["modelValue"])]),e("div",Ue,[ke,we,t(R,{modelValue:l.product,"onUpdate:modelValue":o[5]||(o[5]=s=>l.product=s),options:l.products,"emit-value":"","map-options":"","use-input":"",clearable:"",outlined:"","option-label":"name",onFilter:m.filterFn,dense:""},null,8,["modelValue","options","onFilter"])]),e("div",De,[Ae,qe,t(n,{modelValue:l.cantidad,"onUpdate:modelValue":o[6]||(o[6]=s=>l.cantidad=s),placeholder:"Libras",clearable:"",outlined:"",dense:""},null,8,["modelValue"])]),e("div",Pe,[t(u,{color:"primary",label:"Agregar",onClick:m.agregarProducto,"no-caps":"",class:"text-bold",icon:"add_circle_outline",loading:l.loading},null,8,["onClick","loading"])]),e("div",Be,[t(H,{dense:""},{default:d(()=>[Le,l.productBuy.length>0?(r(),f("tbody",Qe,[(r(!0),f(N,null,Y(l.productBuy,s=>(r(),f("tr",{key:s.id},[e("td",null,h(s.name),1),e("td",Oe,h(s.stock),1),e("td",Se,[t(u,{color:"negative",label:"Eliminar","no-caps":"",dense:"",size:"10px",icon:"delete",onClick:()=>{l.productBuy=l.productBuy.filter(_=>_.id!==s.id)}},null,8,["onClick"])])]))),128))])):(r(),f("tbody",Ee,Ge))]),_:1})]),e("div",Ie,[t(u,{color:"green",label:"Guardar",onClick:m.productAdd,"no-caps":"",class:"text-bold",icon:"save",loading:l.loading},null,8,["onClick","loading"])])])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),t(y,{modelValue:l.gastoDialog,"onUpdate:modelValue":o[8]||(o[8]=s=>l.gastoDialog=s),position:"right",maximized:""},{default:d(()=>[t(S,{onGastoCreated:m.gastoCreated,viaje_id:l.id},null,8,["onGastoCreated","viaje_id"])]),_:1},8,["modelValue"]),t(y,{modelValue:l.lanceDialog,"onUpdate:modelValue":o[35]||(o[35]=s=>l.lanceDialog=s)},{default:d(()=>[t(x,{style:{width:"950px","max-width":"95vh"}},{default:d(()=>[t(b,{class:"row items-center q-pb-none"},{default:d(()=>[Ne,t(Q),t(u,{flat:"",round:"",dense:"",icon:"close",onClick:o[9]||(o[9]=()=>{l.lanceDialog=!1})})]),_:1}),t(b,null,{default:d(()=>[t(O,{onSubmit:m.lanceSave},{default:d(()=>[e("div",Ye,[e("div",Re,[He,t(n,{modelValue:l.lance.fecha,"onUpdate:modelValue":o[10]||(o[10]=s=>l.lance.fecha=s),outlined:"",dense:"",type:"date"},null,8,["modelValue"])]),e("div",Te,[Me,t(n,{modelValue:l.lance.hora_inicio,"onUpdate:modelValue":o[11]||(o[11]=s=>l.lance.hora_inicio=s),outlined:"",dense:"",type:"time"},null,8,["modelValue"])]),e("div",ze,[Je,t(n,{modelValue:l.lance.hora_fin,"onUpdate:modelValue":o[12]||(o[12]=s=>l.lance.hora_fin=s),outlined:"",dense:"",type:"time"},null,8,["modelValue"])]),e("div",We,[Xe,t(n,{modelValue:l.lance.numero,"onUpdate:modelValue":o[13]||(o[13]=s=>l.lance.numero=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",Ze,[Ke,t(n,{modelValue:l.lance.latitud,"onUpdate:modelValue":o[14]||(o[14]=s=>l.lance.latitud=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",$e,[eo,t(n,{modelValue:l.lance.longitud,"onUpdate:modelValue":o[15]||(o[15]=s=>l.lance.longitud=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",oo,[lo,t(n,{modelValue:l.lance.camaron_blanco,"onUpdate:modelValue":o[16]||(o[16]=s=>l.lance.camaron_blanco=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",so,[to,t(n,{modelValue:l.lance.camaron_cafe,"onUpdate:modelValue":o[17]||(o[17]=s=>l.lance.camaron_cafe=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",ao,[no,t(n,{modelValue:l.lance.camaron_rojo,"onUpdate:modelValue":o[18]||(o[18]=s=>l.lance.camaron_rojo=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",io,[co,t(n,{modelValue:l.lance.camaroncillo,"onUpdate:modelValue":o[19]||(o[19]=s=>l.lance.camaroncillo=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",ro,[uo,t(n,{modelValue:l.lance.calamar,"onUpdate:modelValue":o[20]||(o[20]=s=>l.lance.calamar=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",mo,[ho,t(n,{modelValue:l.lance.caracol,"onUpdate:modelValue":o[21]||(o[21]=s=>l.lance.caracol=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",po,[_o,t(n,{modelValue:l.lance.corvina,"onUpdate:modelValue":o[22]||(o[22]=s=>l.lance.corvina=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",go,[bo,t(n,{modelValue:l.lance.babosa,"onUpdate:modelValue":o[23]||(o[23]=s=>l.lance.babosa=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",fo,[Vo,t(n,{modelValue:l.lance.guabina,"onUpdate:modelValue":o[24]||(o[24]=s=>l.lance.guabina=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",vo,[xo,t(n,{modelValue:l.lance.jaiba,"onUpdate:modelValue":o[25]||(o[25]=s=>l.lance.jaiba=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",yo,[jo,t(n,{modelValue:l.lance.langosta,"onUpdate:modelValue":o[26]||(o[26]=s=>l.lance.langosta=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",Co,[Uo,t(n,{modelValue:l.lance.pulpo,"onUpdate:modelValue":o[27]||(o[27]=s=>l.lance.pulpo=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",ko,[wo,t(n,{modelValue:l.lance.jurel,"onUpdate:modelValue":o[28]||(o[28]=s=>l.lance.jurel=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",Do,[Ao,t(n,{modelValue:l.lance.anguila,"onUpdate:modelValue":o[29]||(o[29]=s=>l.lance.anguila=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",qo,[Po,t(n,{modelValue:l.lance.pargo,"onUpdate:modelValue":o[30]||(o[30]=s=>l.lance.pargo=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",Bo,[Lo,t(n,{modelValue:l.lance.robalo,"onUpdate:modelValue":o[31]||(o[31]=s=>l.lance.robalo=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",Qo,[Oo,t(n,{modelValue:l.lance.cienero,"onUpdate:modelValue":o[32]||(o[32]=s=>l.lance.cienero=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",So,[Eo,t(n,{modelValue:l.lance.otras_especies,"onUpdate:modelValue":o[33]||(o[33]=s=>l.lance.otras_especies=s),outlined:"",dense:""},null,8,["modelValue"])]),e("div",Fo,[Go,t(M,{"min-height":"5rem",modelValue:l.lance.observaciones,"onUpdate:modelValue":o[34]||(o[34]=s=>l.lance.observaciones=s)},null,8,["modelValue"])]),e("div",Io,[t(u,{color:"green",label:"Guardar",type:"submit","no-caps":"",class:"text-bold",icon:"save",loading:l.loading},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),No]),_:1})}var tl=E(W,[["render",Yo]]);export{tl as default};
