import{_ as G,Q as r,R as u,S as o,T as s,aB as f,V as e,aE as V,U as p,Y as m,Z as C,$ as D,aC as x,W as i,X as d,aT as w,aD as Q,L as P,ar as I,a3 as A,a0 as B}from"./index.ef53a57e.js";import{a as z,b as _,d as T,e as c}from"./QChip.2472fcbc.js";import{Q as S}from"./QBtnDropdown.07f04442.js";import{Q as U}from"./QMarkupTable.487b9519.js";import{Q as E}from"./QForm.2721a59c.js";import{Q as M}from"./QPage.0899af7a.js";const N={data(){return{search:"",loading:!1,deudores:[],dialog:!1,historyDialog:!1,deudor:{},pago:""}},mounted(){this.deudoresGet()},methods:{anularPago(a){this.$alert.confirm("\xBFEst\xE1 seguro de anular el pago?").onOk(()=>{this.loading=!0,this.$axios.post("anularPago/"+a.id).then(n=>{this.$alert.success("Pago anulado con \xE9xito");const y=this.deudor.payments.findIndex(v=>v.id===a.id);this.deudor.payments[y].status="ANULADO",this.deudoresGet()}).catch(n=>{this.$alert.error(n.response.data.message)}).finally(()=>{this.loading=!1})})},history(a){this.historyDialog=!0,this.deudor=a},agregarPago(a){this.dialog=!0,this.deudor=a,this.pago=a.debt},registrarPago(){this.loading=!0,this.$axios.post("payments",{sale_id:this.deudor.id,amount:this.pago}).then(a=>{this.$alert.success(a.data.message),this.dialog=!1,this.deudoresGet()}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},deudoresGet(){this.loading=!0,this.$axios.get("debtors",{params:{search:this.search}}).then(a=>{this.deudores=a.data}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})}}},F={class:"row"},L={class:"col-8 col-md-4"},Y={class:"col-4 col-md-4"},q={class:"col-12"},H=e("thead",{class:"bg-primary text-white"},[e("tr",null,[e("th",null,"Operaci\xF3n"),e("th",null,"Fecha"),e("th",null,"Cliente"),e("th",null,"Total"),e("th",null,"Pago"),e("th",null,"Deuda"),e("th",null,"Usuario"),e("th",null,"Estado"),e("th",null,"Observaci\xF3n")])],-1),R={class:"text-right"},W={class:"text-right"},X={class:"text-right"},Z={class:"text-bold"},j=e("br",null,null,-1),J={class:"text-bold text-red"},K=e("br",null,null,-1),$={class:"text-bold text-green"},ee=e("br",null,null,-1),le={class:"text-bold"},te={class:"text-bold"},se=e("br",null,null,-1),oe={class:"text-bold text-red"},ae=e("br",null,null,-1),ne={class:"text-bold text-green"},ie=e("br",null,null,-1),re={class:"text-bold"},de=e("thead",{class:"bg-primary text-white"},[e("tr",null,[e("th",null,"Opciones"),e("th",null,"Fecha"),e("th",null,"Monto"),e("th",null,"Usuario"),e("th",null,"Estado")])],-1),ue={class:"text-right"};function ce(a,n,y,v,t,h){return r(),u(M,{class:"bg-grey-3 q-pa-md"},{default:o(()=>[s(x,null,{default:o(()=>[s(f,{class:"q-pa-xs"},{default:o(()=>[e("div",F,[e("div",L,[s(V,{modelValue:t.search,"onUpdate:modelValue":n[0]||(n[0]=l=>t.search=l),label:"Buscar por cliente o usuario",placeholder:"Buscar",dense:"",outlined:""},null,8,["modelValue"])]),e("div",Y,[s(p,{modelValue:t.search,"onUpdate:modelValue":n[1]||(n[1]=l=>t.search=l),color:"primary",label:"Buscar",onClick:h.deudoresGet,loading:t.loading,icon:"search","no-caps":""},null,8,["modelValue","onClick","loading"])]),e("div",q,[s(U,{dense:"","wrap-cells":"",separator:"cell"},{default:o(()=>[H,e("tbody",null,[(r(!0),m(D,null,C(t.deudores,l=>{var g,b,k;return r(),m("tr",{key:l.id},[e("td",null,[s(S,{label:"Opciones",color:"primary","no-caps":"",size:"10px","auto-close":""},{default:o(()=>[P((r(),u(z,{clickable:"",onClick:O=>h.agregarPago(l)},{default:o(()=>[s(_,{avatar:""},{default:o(()=>[s(I,{name:"payment",color:"green"})]),_:1}),s(_,null,{default:o(()=>[s(T,null,{default:o(()=>[d("Agregar Pago")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[A]]),P((r(),u(z,{clickable:"",onClick:O=>h.history(l)},{default:o(()=>[s(_,{avatar:""},{default:o(()=>[s(I,{name:"visibility",color:"primary"})]),_:1}),s(_,null,{default:o(()=>[s(T,null,{default:o(()=>[d("Ver Detalles")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[A]])]),_:2},1024)]),e("td",null,i(a.$filters.formatdMYHID(l.date)),1),e("td",null,i(a.$filters.capitalizeText(((g=l.client)==null?void 0:g.name)+" "+(((b=l.client)==null?void 0:b.lastname)!=null?(k=l.client)==null?void 0:k.lastname:""))),1),e("td",R,i(l.total),1),e("td",W,[l.pago>0?(r(),u(c,{key:0,color:"positive","text-color":"white",label:l.pago,dense:"",size:"10px"},null,8,["label"])):B("",!0)]),e("td",X,[l.debt>0?(r(),u(c,{key:0,color:"negative","text-color":"white",label:l.debt,dense:"",size:"10px"},null,8,["label"])):B("",!0)]),e("td",null,i(l.user.name),1),e("td",null,[l.status=="ACTIVO"?(r(),u(c,{key:0,color:"positive","text-color":"white",label:"Activo",dense:"",size:"10px"})):(r(),u(c,{key:1,color:"negative","text-color":"white",label:"Inactivo",dense:"",size:"10px"}))]),e("td",null,i(l.observacion),1)])}),128))])]),_:1})])])]),_:1})]),_:1}),s(Q,{modelValue:t.dialog,"onUpdate:modelValue":n[4]||(n[4]=l=>t.dialog=l)},{default:o(()=>[s(x,{style:{width:"250px","max-width":"90vw"}},{default:o(()=>[s(f,null,{default:o(()=>[s(E,{onSubmit:h.registrarPago},{default:o(()=>[e("div",null,[e("span",Z,i(t.deudor.client.name+" "+(t.deudor.client.lastname!=null?t.deudor.client.lastname:"")),1),j,d(" Deuda: "),e("span",J,i(t.deudor.debt),1),d(),K,d(" Pagado: "),e("span",$,i(t.deudor.pago),1),d(),ee,d(" Total: "),e("span",le,i(t.deudor.total),1)]),s(V,{modelValue:t.pago,"onUpdate:modelValue":n[2]||(n[2]=l=>t.pago=l),label:"Monto",type:"number",dense:"",outlined:"",step:"0.01",rules:[l=>l>0||"Debe ser mayor a 0",l=>l<=t.deudor.debt||"Debe ser menor o igual a la deuda"]},null,8,["modelValue","rules"]),s(w,{align:"right"},{default:o(()=>[s(p,{label:"Cancelar",color:"negative",onClick:n[3]||(n[3]=l=>t.dialog=!1),"no-caps":"",loading:t.loading},null,8,["loading"]),s(p,{label:"Guardar",color:"primary",type:"submit","no-caps":"",loading:t.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Q,{modelValue:t.historyDialog,"onUpdate:modelValue":n[6]||(n[6]=l=>t.historyDialog=l)},{default:o(()=>[s(x,{style:{width:"500px","max-width":"90vw"}},{default:o(()=>[s(f,null,{default:o(()=>[e("div",null,[e("span",te,i(t.deudor.client.name+" "+t.deudor.client.lastname),1),se,d(" Deuda: "),e("span",oe,i(t.deudor.debt),1),d(),ae,d(" Pagado: "),e("span",ne,i(t.deudor.pago),1),d(),ie,d(" Total: "),e("span",re,i(t.deudor.total),1)]),s(U,{dense:"","wrap-cells":"",separator:"cell"},{default:o(()=>[de,e("tbody",null,[(r(!0),m(D,null,C(t.deudor.payments,l=>{var g;return r(),m("tr",{key:l.id},[e("td",null,[s(p,{label:"Anular",color:"negative",dense:"",icon:"delete","no-caps":"",size:"10px",onClick:b=>h.anularPago(l)},null,8,["onClick"])]),e("td",null,i(a.$filters.formatdMYHID(l.date)),1),e("td",ue,i(l.amount),1),e("td",null,i((g=l.user)==null?void 0:g.name),1),e("td",null,[l.status=="PAGADO"?(r(),u(c,{key:0,color:"positive","text-color":"white",label:"Pagado",dense:"",size:"10px"})):(r(),u(c,{key:1,color:"negative","text-color":"white",label:"Anulado",dense:"",size:"10px"}))])])}),128))])]),_:1}),s(w,{align:"right"},{default:o(()=>[s(p,{label:"Cerrar",color:"negative",onClick:n[5]||(n[5]=l=>t.historyDialog=!1),"no-caps":"",loading:t.loading},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var fe=G(N,[["render",ce]]);export{fe as default};
